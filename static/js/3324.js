(function($){$.fn.ajaxSubmit=function(options){if(!this.length){log("ajaxSubmit: skipping submit process - no element selected");return this}if(typeof options=="function"){options={success:options}}options=$.extend({url:this.attr("action")||window.location.toString(),type:this.attr("method")||"GET"},options||{});var veto={};this.trigger("form-pre-serialize",[this,options,veto]);if(veto.veto){log("ajaxSubmit: submit vetoed via form-pre-serialize trigger");return this}if(options.beforeSerialize&&options.beforeSerialize(this,options)===false){log("ajaxSubmit: submit aborted via beforeSerialize callback");return this}var a=this.formToArray(options.semantic);if(options.data){options.extraData=options.data;for(var n in options.data){if(options.data[n] instanceof Array){for(var k in options.data[n]){a.push({name:n,value:options.data[n][k]})}}else{a.push({name:n,value:options.data[n]})}}}if(options.beforeSubmit&&options.beforeSubmit(a,this,options)===false){log("ajaxSubmit: submit aborted via beforeSubmit callback");return this}this.trigger("form-submit-validate",[a,this,options,veto]);if(veto.veto){log("ajaxSubmit: submit vetoed via form-submit-validate trigger");return this}var q=$.param(a);if(options.type.toUpperCase()=="GET"){options.url+=(options.url.indexOf("?")>=0?"&":"?")+q;options.data=null}else{options.data=q}var $form=this,callbacks=[];if(options.resetForm){callbacks.push(function(){$form.resetForm()})}if(options.clearForm){callbacks.push(function(){$form.clearForm()})}if(!options.dataType&&options.target){var oldSuccess=options.success||function(){};callbacks.push(function(data){$(options.target).html(data).each(oldSuccess,arguments)})}else{if(options.success){callbacks.push(options.success)}}options.success=function(data,status){for(var i=0,max=callbacks.length;i<max;i++){callbacks[i].apply(options,[data,status,$form])}};var files=$("input:file",this).fieldValue();var found=false;for(var j=0;j<files.length;j++){if(files[j]){found=true}}if(options.iframe||found){if(options.closeKeepAlive){$.get(options.closeKeepAlive,fileUpload)}else{fileUpload()}}else{$.ajax(options)}this.trigger("form-submit-notify",[this,options]);return this;function fileUpload(){var form=$form[0];if($(":input[name=submit]",form).length){alert('Error: Form elements must not be named "submit".');return}var opts=$.extend({},$.ajaxSettings,options);var s=jQuery.extend(true,{},$.extend(true,{},$.ajaxSettings),opts);var id="jqFormIO"+(new Date().getTime());var $io=$('<iframe id="'+id+'" name="'+id+'" src="about:blank" />');var io=$io[0];$io.css({position:"absolute",top:"-1000px",left:"-1000px"});var xhr={aborted:0,responseText:null,responseXML:null,status:0,statusText:"n/a",getAllResponseHeaders:function(){},getResponseHeader:function(){},setRequestHeader:function(){},abort:function(){this.aborted=1;$io.attr("src","about:blank")}};var g=opts.global;if(g&&!$.active++){$.event.trigger("ajaxStart")}if(g){$.event.trigger("ajaxSend",[xhr,opts])}if(s.beforeSend&&s.beforeSend(xhr,s)===false){s.global&&jQuery.active--;return}if(xhr.aborted){return}var cbInvoked=0;var timedOut=0;var sub=form.clk;if(sub){var n=sub.name;if(n&&!sub.disabled){options.extraData=options.extraData||{};options.extraData[n]=sub.value;if(sub.type=="image"){options.extraData[name+".x"]=form.clk_x;options.extraData[name+".y"]=form.clk_y}}}setTimeout(function(){var t=$form.attr("target"),a=$form.attr("action");form.setAttribute("target",id);if(form.getAttribute("method")!="POST"){form.setAttribute("method","POST")}if(form.getAttribute("action")!=opts.url){form.setAttribute("action",opts.url)}if(!options.skipEncodingOverride){$form.attr({encoding:"multipart/form-data",enctype:"multipart/form-data"})}if(opts.timeout){setTimeout(function(){timedOut=true;cb()},opts.timeout)}var extraInputs=[];try{if(options.extraData){for(var n in options.extraData){extraInputs.push($('<input type="hidden" name="'+n+'" value="'+options.extraData[n]+'" />').appendTo(form)[0])}}$io.appendTo("body");io.attachEvent?io.attachEvent("onload",cb):io.addEventListener("load",cb,false);form.submit()}finally{form.setAttribute("action",a);t?form.setAttribute("target",t):$form.removeAttr("target");$(extraInputs).remove()}},10);var nullCheckFlag=0;function cb(){if(cbInvoked++){return}io.detachEvent?io.detachEvent("onload",cb):io.removeEventListener("load",cb,false);var ok=true;try{if(timedOut){throw"timeout"}var data,doc;doc=io.contentWindow?io.contentWindow.document:io.contentDocument?io.contentDocument:io.document;if((doc.body==null||doc.body.innerHTML=="")&&!nullCheckFlag){nullCheckFlag=1;cbInvoked--;setTimeout(cb,100);return}xhr.responseText=doc.body?doc.body.innerHTML:null;xhr.responseXML=doc.XMLDocument?doc.XMLDocument:doc;xhr.getResponseHeader=function(header){var headers={"content-type":opts.dataType};return headers[header]};if(opts.dataType=="json"||opts.dataType=="script"){var ta=doc.getElementsByTagName("textarea")[0];xhr.responseText=ta?ta.value:xhr.responseText}else{if(opts.dataType=="xml"&&!xhr.responseXML&&xhr.responseText!=null){xhr.responseXML=toXml(xhr.responseText)}}data=$.httpData(xhr,opts.dataType)}catch(e){ok=false;$.handleError(opts,xhr,"error",e)}if(ok){opts.success(data,"success");if(g){$.event.trigger("ajaxSuccess",[xhr,opts])}}if(g){$.event.trigger("ajaxComplete",[xhr,opts])}if(g&&!--$.active){$.event.trigger("ajaxStop")}if(opts.complete){opts.complete(xhr,ok?"success":"error")}setTimeout(function(){$io.remove();xhr.responseXML=null},100)}function toXml(s,doc){if(window.ActiveXObject){doc=new ActiveXObject("Microsoft.XMLDOM");doc.async="false";doc.loadXML(s)}else{doc=(new DOMParser()).parseFromString(s,"text/xml")}return(doc&&doc.documentElement&&doc.documentElement.tagName!="parsererror")?doc:null}}};$.fn.ajaxForm=function(options){return this.ajaxFormUnbind().bind("submit.form-plugin",function(){$(this).ajaxSubmit(options);return false}).each(function(){$(":submit,input:image",this).bind("click.form-plugin",function(e){var form=this.form;form.clk=this;if(this.type=="image"){if(e.offsetX!=undefined){form.clk_x=e.offsetX;form.clk_y=e.offsetY}else{if(typeof $.fn.offset=="function"){var offset=$(this).offset();form.clk_x=e.pageX-offset.left;form.clk_y=e.pageY-offset.top}else{form.clk_x=e.pageX-this.offsetLeft;form.clk_y=e.pageY-this.offsetTop}}}setTimeout(function(){form.clk=form.clk_x=form.clk_y=null},10)})})};$.fn.ajaxFormUnbind=function(){this.unbind("submit.form-plugin");return this.each(function(){$(":submit,input:image",this).unbind("click.form-plugin")})};$.fn.formToArray=function(semantic){var a=[];if(this.length==0){return a}var form=this[0];var els=semantic?form.getElementsByTagName("*"):form.elements;if(!els){return a}for(var i=0,max=els.length;i<max;i++){var el=els[i];var n=el.name;if(!n){continue}if(semantic&&form.clk&&el.type=="image"){if(!el.disabled&&form.clk==el){a.push({name:n+".x",value:form.clk_x},{name:n+".y",value:form.clk_y})}continue}var v=$.fieldValue(el,true);if(v&&v.constructor==Array){for(var j=0,jmax=v.length;j<jmax;j++){a.push({name:n,value:v[j]})}}else{if(v!==null&&typeof v!="undefined"){a.push({name:n,value:v})}}}if(!semantic&&form.clk){var inputs=form.getElementsByTagName("input");for(var i=0,max=inputs.length;i<max;i++){var input=inputs[i];var n=input.name;if(n&&!input.disabled&&input.type=="image"&&form.clk==input){a.push({name:n+".x",value:form.clk_x},{name:n+".y",value:form.clk_y})}}}return a};$.fn.formSerialize=function(semantic){return $.param(this.formToArray(semantic))};$.fn.fieldSerialize=function(successful){var a=[];this.each(function(){var n=this.name;if(!n){return}var v=$.fieldValue(this,successful);if(v&&v.constructor==Array){for(var i=0,max=v.length;i<max;i++){a.push({name:n,value:v[i]})}}else{if(v!==null&&typeof v!="undefined"){a.push({name:this.name,value:v})}}});return $.param(a)};$.fn.fieldValue=function(successful){for(var val=[],i=0,max=this.length;i<max;i++){var el=this[i];var v=$.fieldValue(el,successful);if(v===null||typeof v=="undefined"||(v.constructor==Array&&!v.length)){continue}v.constructor==Array?$.merge(val,v):val.push(v)}return val};$.fieldValue=function(el,successful){var n=el.name,t=el.type,tag=el.tagName.toLowerCase();if(typeof successful=="undefined"){successful=true}if(successful&&(!n||el.disabled||t=="reset"||t=="button"||(t=="checkbox"||t=="radio")&&!el.checked||(t=="submit"||t=="image")&&el.form&&el.form.clk!=el||tag=="select"&&el.selectedIndex==-1)){return null}if(tag=="select"){var index=el.selectedIndex;if(index<0){return null}var a=[],ops=el.options;var one=(t=="select-one");var max=(one?index+1:ops.length);for(var i=(one?index:0);i<max;i++){var op=ops[i];if(op.selected){var v=op.value;if(!v){v=(op.attributes&&op.attributes.value&&!(op.attributes.value.specified))?op.text:op.value}if(one){return v}a.push(v)}}return a}return el.value};$.fn.clearForm=function(){return this.each(function(){$("input,select,textarea",this).clearFields()})};$.fn.clearFields=$.fn.clearInputs=function(){return this.each(function(){var t=this.type,tag=this.tagName.toLowerCase();if(t=="text"||t=="password"||tag=="textarea"){this.value=""}else{if(t=="checkbox"||t=="radio"){this.checked=false}else{if(tag=="select"){this.selectedIndex=-1}}}})};$.fn.resetForm=function(){return this.each(function(){if(typeof this.reset=="function"||(typeof this.reset=="object"&&!this.reset.nodeType)){this.reset()}})};$.fn.enable=function(b){if(b==undefined){b=true}return this.each(function(){this.disabled=!b})};$.fn.selected=function(select){if(select==undefined){select=true}return this.each(function(){var t=this.type;if(t=="checkbox"||t=="radio"){this.checked=select}else{if(this.tagName.toLowerCase()=="option"){var $sel=$(this).parent("select");if(select&&$sel[0]&&$sel[0].type=="select-one"){$sel.find("option").selected(false)}this.selected=select}}})};function log(){if($.fn.ajaxSubmit.debug&&window.console&&window.console.log){window.console.log("[jquery.form] "+Array.prototype.join.call(arguments,""))}}})(jQuery);jQuery(function($){$.fn.fcbkcomplete=function(opt){return this.each(function(){function init(){createFCBK();preSet();addInput(0)}function createFCBK(){element.hide();select_holder.hide();select_holder.attr("multiple","multiple");if(select_holder.attr("name").indexOf("[]")==-1){select_attr_name=select_holder.attr("name")+"[]";if(options.select_holder_name){select_attr_name=options.select_holder_name+"[]"}select_holder.attr("name",select_attr_name)}holder=$(document.createElement("ul"));holder.attr("class","holder");if(options.holder_class){holder.addClass(options.holder_class)}select_holder.after(holder);holder_clear=$(document.createElement("div"));holder_clear.addClass("clear");holder.after(holder_clear);complete=$(document.createElement("div"));complete.addClass("auto-complete");complete.append('<div class="default">'+options.complete_text+"</div>");feed=$(document.createElement("ul"));feed.attr("id",elemid+"_feed");complete.prepend(feed);holder_clear.after(complete)}function preSet(){select_holder.children("option").each(function(i,option){option=$(option);if(option.hasClass("selected")){addItem(option.text(),option.val(),true);option.attr("selected","selected")}else{option.removeAttr("selected")}})}function addItem(title,value,preadded){if(options.restrict_add_element){$("#"+elemid+"_annoninput").find(".maininput").val("");handleOnSelect(title,value);return false}var li=document.createElement("li");var txt=document.createTextNode(title);var aclose=document.createElement("a");$(li).attr({"class":"bit-box"+(options.close_link?"":" no_close"),rel:value});$(li).prepend(txt);if(options.close_link){$(aclose).attr({"class":"closebutton",href:"#"})}li.appendChild(aclose);holder.append(li);$(aclose).click(function(){$(this).parent("li").fadeOut("fast",function(){removeItem($(this));if(options.number_of_elements&&!holder.find(".maininput").length){addInput(1)}});return false});if(!preadded){$("#"+elemid+"_annoninput").remove();addInput(1);handleOnSelect(title,value)}holder.children("li.bit-box.deleted").removeClass("deleted");feed.hide()}function handleOnSelect(title,value){var _item;if(select_holder.children("option[value="+value+"]").length){_item=select_holder.children("option[value="+value+"]");_item.get(0).setAttribute("selected","selected");if(!_item.hasClass("selected")){_item.addClass("selected")}}else{var _item=$(document.createElement("option"));_item.attr("value",value).get(0).setAttribute("selected","selected");_item.attr("value",value).addClass("selected");_item.text(title);select_holder.append(_item)}if(options.onselect.length){funCall(options.onselect,_item)}}function removeItem(item){select_holder.children("option[value="+item.attr("rel")+"]").remove();item.remove();if(options.onremove.length){funCall(options.onremove,item)}}function addInput(focusme){if(options.number_of_elements&&element.parent().find("li.bit-box").length==options.number_of_elements){return false}var li=$(document.createElement("li"));var input=$(document.createElement("input"));li.attr({"class":"bit-input",id:elemid+"_annoninput"});input.attr({type:"text","class":"maininput"});if(options.hint_text){input.attr({value:options.hint_text})}if(options.input_default_class){input.addClass(options.input_default_class)}holder.append(li.append(input));input.focus(function(){complete.width(holder.outerWidth());complete.css("left",holder.position().left+"px");if(!options.json_cache){feed.html("")}complete.children(".default").html(options.complete_text);if(options.hint_text){hint_val=input.val();input.val("")}complete.fadeIn("fast")}).blur(function(){$(document).click(function(event){if($(event.target).attr("class")!="holder"&&$(event.target).attr("class")!="maininput"){if(options.hint_text){input.val(options.hint_text)}complete.fadeOut("fast");if(options.enable_search_handler){mouseovered_elem_url=""}}})});holder.click(function(){input.focus();if(feed.children("li").length&&input.val().length){feed.show()}else{feed.hide();complete.children(".default").show()}});input.keyup(function(event){if(timer){clearTimeout(timer)}if(xhrObj){xhrObj.abort()}var etext=input.val();timer=setTimeout(function(){if(event.keyCode==13&&options.enable_search_handler){if(mouseovered_elem_url!=""){location.href=mouseovered_elem_url;return}else{var encoded_string=escape(etext);encoded_string=encoded_string.replace(/%20/gi,"+");location.href=MAIN_URL+"/search/"+encoded_string;return}}if(event.keyCode==8&&etext.length==0){if(options.enable_search_handler){mouseovered_elem_url=""}feed.hide();if(holder.children("li.bit-box.deleted").length==0){holder.children("li.bit-box:last").addClass("deleted");return false}else{holder.children("li.bit-box.deleted").fadeOut("fast",function(){removeItem($(this));return false})}}if(event.keyCode!=40&&event.keyCode!=38&&etext.length!=0){counter=0;if(options.json_url||options.preload_data){if(options.json_cache&&json_cache){addMemebers(etext);bindEvents()}else{if(options.json_url){xhrObj=Global.getJSONAction(options.json_url,{tag:etext},function(data){complete.fadeIn("fast");var error_flag=(!data.response.error_flag||(data.response.error_flag=="undefined"))?false:true;addMemebers(etext,data.response.items_list,error_flag);json_cache=options.json_cache;bindEvents();hideFeed()})}else{if(options.preload_data){addMemebers(etext,options.preload_data);json_cache=true;bindEvents()}}}}else{addMemebers(etext);bindEvents()}if(options.json_cache){hideFeed()}}},200)});if(focusme){setTimeout(function(){input.focus();complete.children(".default").show()},1)}}function hideFeed(){if(match_flag){complete.children(".default").hide();feed.show()}else{complete.children(".default").show();feed.hide()}}function addMemeber(content,etext,object){if(options.filter_selected&&select_holder.children("option[value="+object.value+"]").hasClass("selected")){return false}else{content+='<li rel="'+object.value+'"'+(((counter%2)!=0)?' class="odd"':"")+">"+itemIllumination(object.caption,etext)+"</li>";counter++;return content}}function addMemebers(etext,data,error_flag){feed.html("");var error_flag=error_flag?error_flag:false;if(!options.json_cache){cache=new Array();search_string=""}if(data!=null&&data.length){$.each(data,function(i,val){cache.push({caption:val.caption,value:val.value});search_string+=""+(cache.length-1)+":"+val.caption+";"})}var maximum=options.maxshownitems<cache.length?options.maxshownitems:cache.length;var filter="i";if(options.filter_case){filter=""}var content="";if(options.enable_matching){var myregexp=eval("/(?:^|;)\\s*(\\d+)\\s*:[^;]*?"+etext+"[^;]*/g"+filter);var match=myregexp.exec(search_string);while(match!=null&&maximum>0){var id=match[1];var object=cache[id];if(options.filter_selected&&select_holder.children("option[value="+object.value+"]").hasClass("selected")){}else{content+='<li rel="'+object.value+'"'+(((counter%2)!=0)?' class="odd"':"")+">"+itemIllumination(object.caption,etext)+"</li>";counter++;maximum--}match=myregexp.exec(search_string)}}else{while(counter<maximum){var object=cache[counter];content=addMemeber(content,etext,object)}}if(!content){match_flag=false;complete.hide();if(error_flag){complete.children(".default").html(options.error_text)}else{if(options.default_text_show){complete.children(".default").html(options.default_text)}}feed.css("height","auto");return false}else{match_flag=true}feed.append(content);if(counter>options.height){feed.css({height:(options.height*24)+"px",overflow:"auto"})}else{feed.css("height","auto")}}function itemIllumination(text,etext){if(options.filter_case){eval("var text = text.replace(/(.*<span.*\\/span>.*)("+etext+")(<div.*\\/div>.*)/gi,'$1<em>$2</em>$3');")}else{eval("var text = text.replace(/(.*<span.*\\/span>.*)("+etext.toLowerCase()+")(<div.*\\/div>.*)/gi,'$1<em>$2</em>$3');")}return text}function bindFeedEvent(){feed.children("li").mouseover(function(){if(options.enable_search_handler){mouseovered_elem_url=$(this).attr("rel")}feed.children("li").removeClass("auto-focus");$(this).addClass("auto-focus");focuson=$(this)});feed.children("li").mouseout(function(){$(this).removeClass("auto-focus");focuson=null})}function removeFeedEvent(){feed.children("li").unbind("mouseover");feed.children("li").unbind("mouseout");feed.mousemove(function(){bindFeedEvent();feed.unbind("mousemove")})}function bindEvents(){var maininput=$("#"+elemid+"_annoninput").children(".maininput");bindFeedEvent();feed.children("li").unbind("click");feed.children("li").click(function(){var option=$(this);addItem(option.text(),option.attr("rel"));feed.hide();complete.hide()});maininput.unbind("keydown");maininput.keydown(function(event){if(event.keyCode!=8){holder.children("li.bit-box.deleted").removeClass("deleted")}if(options.free_form_text==true){if(event.keyCode==32){addItem(maininput.val(),maininput.val());complete.hide();event.preventDefault();focuson=null;return false}}if(event.keyCode==13){if(focuson!=null){if(focuson.length>0){var option=focuson;addItem(option.text(),option.attr("rel"));complete.hide();event.preventDefault()}}focuson=null;return false}if(event.keyCode==40){removeFeedEvent();if(focuson==null||focuson.length==0){focuson=feed.children("li:visible:first");feed.get(0).scrollTop=0}else{focuson.removeClass("auto-focus");focuson=focuson.nextAll("li:visible:first");var prev=parseInt(focuson.prevAll("li:visible").length,10);var next=parseInt(focuson.nextAll("li:visible").length,10);if((prev>Math.round(options.height/2)||next<=Math.round(options.height/2))&&typeof(focuson.get(0))!="undefined"){feed.get(0).scrollTop=parseInt(focuson.get(0).scrollHeight,10)*(prev-Math.round(options.height/2))}}feed.children("li").removeClass("auto-focus");focuson.addClass("auto-focus");if(options.enable_search_handler&&feed.children("li.auto-focus").attr("rel")!="undefined"){mouseovered_elem_url=feed.children("li.auto-focus").attr("rel")}}if(event.keyCode==38){removeFeedEvent();if(focuson==null||focuson.length==0){focuson=feed.children("li:visible:last");feed.get(0).scrollTop=parseInt(focuson.get(0).scrollHeight,10)*(parseInt(feed.children("li:visible").length,10)-Math.round(options.height/2))}else{focuson.removeClass("auto-focus");focuson=focuson.prevAll("li:visible:first");var prev=parseInt(focuson.prevAll("li:visible").length,10);var next=parseInt(focuson.nextAll("li:visible").length,10);if((next>Math.round(options.height/2)||prev<=Math.round(options.height/2))&&typeof(focuson.get(0))!="undefined"){feed.get(0).scrollTop=parseInt(focuson.get(0).scrollHeight,10)*(prev-Math.round(options.height/2))}}feed.children("li").removeClass("auto-focus");focuson.addClass("auto-focus");if(options.enable_search_handler&&feed.children("li.auto-focus").attr("rel")!="undefined"){mouseovered_elem_url=feed.children("li.auto-focus").attr("rel")}}})}function addTextItem(value){if(options.newel){feed.children("li[fckb=1]").remove();if(value.length==0){return}var li=$(document.createElement("li"));li.attr({rel:value,fckb:"1"}).html(value);feed.prepend(li);counter++}else{return}}function funCall(func,item){var _object="";for(i=0;i<item.get(0).attributes.length;i++){if(item.get(0).attributes[i].nodeValue!=null){_object+='"_'+item.get(0).attributes[i].nodeName+'": "'+item.get(0).attributes[i].nodeValue+'",'}}_object="{"+_object+' caption: "'+item.text()+'", notinuse: 0}';if(options.callback_save_variable!=""){eval(func+"("+_object+", "+options.callback_save_variable+")")}else{eval(func+"("+_object+")")}}var options=$.extend({json_url:null,preload_data:null,json_cache:true,height:"10",newel:false,filter_case:false,filter_hide:true,filter_selected:true,complete_text:"start typing...",maxshownitems:30,onselect:"",onremove:"",number_of_elements:"",hint_text:"",input_default_class:"",holder_class:"",close_link:true,holder_exists:"",restrict_add_element:false,default_text:"no results found",error_text:"something went wrong, please try your query again",enable_search_handler:false,default_text_show:true,free_form_text:false,callback_save_variable:"",enable_matching:true,select_holder_name:""},opt);var holder=null;var feed=null;var complete=null;var timer=null;var counter=0;var cache=new Array();var json_cache=false;var search_string="";var focuson=null;var xhrObj=null;var select_holder=null;var hint_val="";var element=$(this);var match_flag=true;var mouseovered_elem_url="";if(options.holder_exists){select_holder=$(options.holder_exists)}else{select_holder=$(document.createElement("select"));select_holder.attr({name:"selected_lists"});element.after(select_holder)}var elemid=element.attr("id");init();return this})}});jQuery(function(){manu.init()});(function(window){gDisableJSValidation=false;gJsHandlers=[];gValidateRules=new Object;gValidateRules1=new Object;gMessages=new Object;pageloadflag=true;lasthash="";var manu={debugJavascript:true,supportHistoryPlugin:false,dialogElement:null,pendingJs:[],executedHandlers:[],ajaxError:false,loadedScripts:[],loadedStyles:[],init:function(){if(manu.supportHistoryPlugin){if(location.hash){manu.pagination.handlePageload(location.hash)}$.historyInit(manu.utils.handlePageload)}$.ajaxSetup({cache:false,dataFilter:manu.sanitizeResponseData});$("#loading").hide();$("#loading").ajaxSend(function(event,xhr,options){if(options.dataType=="json"){xhr.setRequestHeader("Fw-Json",1)}xhr.setRequestHeader("Fw-Ajax",1);$(this).show()});$("#loading").ajaxComplete(function(event,xhr,options){$(this).hide();manu.executePendingJs()});$("#loading").ajaxError(function(event,request,settings){manu.handleAjaxError(request.responseText,settings.url);return false});$(".popup").live("click",function(e){e.stopPropagation();var href=$(this).attr("href");var height=$(this).attr("data-popup-height");var width=$(this).attr("data-popup-width");var params={width:parseInt(width),height:parseInt(height),modal:true};manu.ajaxDialog(href,{},params);return false})},sanitizeResponseData:function(data,type){if(data.indexOf("<!--FW_SEPARATOR-->")<=0){return data}var temp=data.split("<!--FW_SEPARATOR-->");var fwdata=temp[0];data=temp[1];if(fwdata.match(/[\s\S]*<!--FW_DEBUG-->[\s\S]*/)){var debugData=fwdata.replace(/^[\s\S]*?<!--FW_DEBUG-->([\s\S]*?)<!--FW_DEBUG-->[\s\S]*?$/,"$1");if(debugData){$("#fw_debug_ajax_actions").append(debugData)}}if(fwdata.match(/[\s\S]*<!--FW_JS-->[\s\S]*/)){var js=fwdata.replace(/^[\s\S]*?<!--FW_JS-->([\s\S]*?)<!--FW_JS-->[\s\S]*?$/,"$1");if(js){manu.pendingJs.push(js)}}return data},log:function(msg){if(typeof console!="undefined"){if(console.log){console.log(msg)}}},debug:function(msg){if(typeof console!="undefined"){if(console.log&&manu.debugJavascript&&ENVIRONMENT!="prd"){console.log(msg)}}},executePendingJs:function(){if(manu.pendingJs.length>0){var js=manu.pendingJs.pop();eval(js)}},loadScripts:function(scripts){if(!scripts){return}for(var i in scripts){var script=scripts[i];manu.debug("loading script "+script);if($.inArray(script,manu.loadedScripts)==-1){$.ajax({url:script,dataType:"script",async:false});manu.loadedScripts.push(script)}else{manu.log("script already loaded")}}},loadStyles:function(styles){if(!styles){return}for(var i in styles){var style=styles[i];manu.debug("loading style "+style);if($.inArray(style,manu.loadedStyles)==-1){$('<link rel="stylesheet" type="text/css" href="'+style+'" >').appendTo("head");manu.loadedStyles.push(style)}else{manu.log("style already loaded")}}},executeJsHandlers:function(handlers){for(var id in handlers){var h=handlers[id];manu.executeJsHandler(id,h.name,h.params,h.alwaysExec)}},executeJsHandler:function(id,handler,params,alwaysExec){if(!alwaysExec&&jQuery.inArray(id,manu.executedHandlers)!=-1){return}if(handler==""){return}var handler1=eval(handler);if(!handler1){throw"Handler "+handler+" is not defined"}var fparams=[];for(var i in params){fparams.push(params[i])}manu.debug("Executing handler ["+handler+"]["+fparams.join(",")+"]");handler1.apply(params,fparams);if(jQuery.inArray(id,manu.executedHandlers)==-1){manu.executedHandlers.push(id)}},getMsg:function(msg_id,args){arg_array=manu.utils.is_array(args);msg=gStaticMessages[msg_id];if(arg_array){for(var i=0;i<args.length;i++){msg=msg.replace("{"+(i+1)+"}",args[i])}}else{msg=msg.replace("{1}",args)}return msg},alertMsg:function(msg_id,args){alert(manu.getMsg(msg_id,args))},confirmMsg:function(msg_id,args){return confirm(manu.getMsg(msg_id,args))},getAction:function(action,params,callback){var actionUrl=URL_PREFIX_AJAX+action;return this.get(actionUrl,params,callback)},get:function(url,params,callback){return jQuery.get(url,params,function(data){var ret=manu.handleAjaxError(data,url);if(!ret){return}if(callback){callback(data)}})},postAction:function(action,params,callback){var actionUrl=URL_PREFIX_AJAX+action;return this.post(actionUrl,params,callback)},post:function(url,params,callback){return jQuery.post(url,params,function(data){var ret=manu.handleAjaxError(data,url);if(!ret){return}if(callback){callback(data)}})},getJSONAction:function(action,params,callback){var actionUrl=URL_PREFIX_AJAX+action;return jQuery.getJSON(actionUrl,params,function(data){var error_flag=false;for(var i in data.messages){if(data.messages[i]["type"]=="E"){error_flag=true}}for(var i in data.verrors){error_flag=true}manu.validation.displayMessages(action,data.messages,true);for(var h in data.handlers){var alwaysExec=data.handlers[h];manu.executeJsHandler(handler,alwaysExec)}if(callback&&!error_flag){callback(data)}})},load:function(target,url,params,callback){return jQuery.get(url,params,function(data){var ret=manu.handleAjaxError(data,url);if(!ret){return}$(target).html(data);if(callback){callback(data)}})},loadAction:function(target,action,params,callback){var actionUrl=URL_PREFIX_AJAX+action;return this.load(target,actionUrl,params,callback)},ajaxSubmitAction:function(form_id,callback){var form=document.getElementById(form_id);var action=manu.getFormAction(form);var ret=manu.form.validateForm(form);if(!ret){return}$(form).ajaxSubmit({success:function(data){var ret=manu.handleAjaxError(data,action);if(!ret){return}if(callback){callback(data)}}})},ajaxSubmitJSON:function(form_id,callback,errorcallback){var form=document.getElementById(form_id);var ret=manu.form.validateForm1(form);if(!ret){return}$(form).ajaxSubmit({dataType:"json",success:function(data){var error_flag=false;for(i in data.messages){if(data.messages[i]["type"]=="E"){error_flag=true}}for(i in data.verrors){error_flag=true}var action=manu.getFormAction(form);manu.validation.displayMessages(action,data.messages,true);for(var h in data.handlers){var alwaysExec=data.handlers[h];manu.executeJsHandler(h,alwaysExec)}if(errorcallback&&error_flag){errorcallback(data)}if(callback&&!error_flag){callback(data)}},error:function(data){if(errorcallback){errorcallback(data)}}})},handleAjaxError:function(data,url){if(!data){return true}if(data.match(/FW_PHP_ERROR/)){var error=data.replace(/<!--FW_PHP_ERROR-->/g,"");alert("Oops! Something went wrong. Please try again.");return false}else{if(data.match(/FW_PHP_EXCEPTION/)){alert("Oops! Something went wrong. Please try again.");return false}else{if(data.match(/FW_AJAX_REDIRECT/)){var redirect_url=data.replace(/.*<!--FW_AJAX_REDIRECT-->(.*?)<!--FW_AJAX_REDIRECT-->.*/m,"$1");window.location.href=redirect_url;return false}}}return true},clearActionMessages:function(action){$(".alert, .alertbox").each(function(){if(!this.className.match("m_"+action.toLowerCase()+"-")){return}$(this).html("");$(this).hide();$(this).parents("form.normal").find("label").removeClass("error_label")})},getFormAction:function(form){var action=form.action;if(!action){var path=location.pathname;action=path.replace(/^(\w+).*/,"$1")}action=action.toLowerCase();action=action.replace(/(\w+)\?/,"$1");action=action.replace(/^.*?(\w+)$/g,"$1");return action},typeAhead:function($input,func,minChars,maxChars,delay){var timeout=false;if($.browser.mozilla){$input.keypress(processKey)}else{$input.keydown(processKey)}function processKey(e){if(($(this).val().length<minChars-1)||($(this).val().length>maxChars-1)){return}if(e.which>=32&&e.which<127||e.which==8){if(timeout){clearTimeout(timeout)}timeout=setTimeout(func,delay)}}},dialog:function(jelem,params){var defaults={dialogClass:"m-dialog"};params=$.extend({},defaults,params);jelem.dialog(params).dialog("open");manu.dialogElement=jelem},closeDialog:function(){if(manu.dialogElement!=null){manu.dialogElement.dialog("destroy");manu.dialogElement=null}return false},ajaxDialog:function(url,urlParams,popParams,callback){$(".m-ajaxDialog").empty();manu.load(".m-ajaxDialog",url,urlParams,callback);manu.dialog($(".m-ajaxDialog"),popParams)},actionDialog:function(msg,callbacks,params){$("#action_dialog").remove();var html='<div id="action_dialog"><div id="action_dialog_msg">'+msg+"</div>";if(callbacks){for(var action in callbacks){html+='<a id="action_dialog_'+action+'" href="javascript:void(0);" class="btn">'+action+"</a>"}}if(params==null){params={}}if(params.width==null){params.width=300}manu.dialog($(html),params);if(callbacks){for(var action in callbacks){var cb=callbacks[action];$("#action_dialog_"+action).click(cb)}}},modal:function(jelem,params){if($("#jqm_window").length==0){$("body").append('<div id="jqm_container" ><div id="jqm_window" class="jqmWindow"><a href="#" class="jqmClose"></a></div></div>')}$("#jqm_window").append(jelem.html());$("#jqm_window").jqm({modal:true});$("#jqm_window").jqmShow()}};manu.validation={displayMessages:function(action,messages,ajax){var alert_flag=false;for(var msg_id1 in messages){var msg_style=messages[msg_id1]["style"];if(msg_style=="A"){alert_flag=true}}if(alert_flag){if($("#alert_messages").length>0){$("#alert_messages").html("")}else{$("body").append('<div id="alert_messages"></div>')}}jQuery(".m_global").html("");jQuery(".m_global").hide("");if(ajax){manu.clearActionMessages(action)}for(var msg_id1 in messages){var msg_str=messages[msg_id1]["msg"];var msg_type=messages[msg_id1]["type"];var msg_style=messages[msg_id1]["style"];var global_flag=messages[msg_id1]["global"];if(global_flag){this.displayGlobalMessage(msg_str,msg_type)}else{this.displayMessage(action,msg_id1,msg_str,msg_type,msg_style)}}if(alert_flag){if(jQuery().dialog){manu.dialog($("#alert_messages"),{buttons:{Ok:function(){manu.closeDialog()}},closeText:""})}else{manu.modal($("#alert_messages"))}}},displayGlobalMessage:function(msg_str,msg_type){var error_class="";if(msg_type=="S"){error_class="success"}else{if(msg_type=="W"){error_class="warning"}else{if(msg_type=="E"){error_class="error"}else{if(msg_type=="I"){error_class="info"}}}}$(".m_global").append("<div class='"+error_class+"'>"+msg_str+"</div>");$(".m_global").show()},displayMessage:function(action,msg_id,msg_str,msg_type,msg_style){var error_classes={S:"success",W:"warning",E:"error",I:"info"};var error_class=error_classes[msg_type];if(!msg_style){msg_style=""}if(msg_style=="A"){$("#alert_messages").append("<span class='"+error_class+"'>"+msg_str+"</span>");return}var msg_html="<span class='"+error_class+"' >"+msg_str+"</span>";action=action.replace(/[^a-z_\-\.]+/gi,"_");var elem_id=".m_"+action+"-"+msg_id;var rest_id=".m_"+action+"-REST";var all_id=".m_"+action+"-ALL";if($(elem_id).length>0){$(elem_id).append(msg_html).height("").show(400)}else{if($(rest_id).length>0){$(rest_id).append(msg_html).height("").show(400)}else{if($(all_id).length>0){$(all_id).append(msg_html).height("").show(400)}}}if(msg_style=="F"){}}};manu.utils={is_array:function(mixed_var){return(mixed_var instanceof Array)},is_object:function(mixed_var){if(mixed_var instanceof Array){return false}else{return(mixed_var!==null)&&(typeof(mixed_var)=="object")}},stripslashes:function(elem){return elem.replace(/^\/+|\/+$/g,"")},htmlSpecialCharsEncode:function(string){string=string.replace(/\&/g,"&amp;");string=string.replace(/>/g,"&gt;");string=string.replace(/</g,"&lt;");string=string.replace(/\"/g,"&quot;");string=string.replace(/\'/g,"&#39;");return string},htmlSpecialCharsDecode:function(string){string=string.replace(/\&gt;/g,">");string=string.replace(/\&lt;/g,"<");string=string.replace(/\&quot;/g,'"');string=string.replace(/\&#039;/g,"'");string=string.replace(/\&#39;/g,"'");string=string.replace(/\&apos;/g,"'");string=string.replace(/\&amp;/g,"&");return string},alertObj:function(obj){var output="";for(var i in obj){output+=i+"="+obj[i]}}};window.manu=manu;window.Global=manu;window.Utils=manu.utils})(window);var Autocomplete={wordlist:[{id:"1",label:"January",value:"January",description:"Month is Jan",img:URL_PREFIX_IMAGE+"activity_reply_icon.jpg"},{id:"2",label:"February",value:"February",description:"Month is Feb",img:URL_PREFIX_IMAGE+"activity_reply_icon.jpg"},{id:"3",label:"March",value:"March",description:"Month is Mar",img:URL_PREFIX_IMAGE+"activity_reply_icon.jpg"},{id:"4",label:"April",value:"April",description:"Month is Apr",img:URL_PREFIX_IMAGE+"activity_reply_icon.jpg"},{id:"5",label:"May",value:"May",description:"Month is May",img:URL_PREFIX_IMAGE+"activity_reply_icon.jpg"}],handleSelectItem:function(currObj,data,elem_name,remove_callback,skip_img_select){if(!remove_callback){remove_callback=""}var img="";if(!skip_img_select){img=(data.item.img)?"<img src='"+data.item.img+"' />":""}var events='data-events="'+remove_callback+'"';currObj.parent().find(".result_container").append("<li class='selected_elem' data-selected='"+data.item.id+"'><div class='elem_cont'>"+img+"<span class='elem_text'>"+data.item.label+"</span><a class='m-form-auto-close' href='javascript:void(0);' "+events+" ><img src='"+URL_PREFIX_IMAGE+"close.png'></a><input type='hidden' name='"+elem_name+"[]' value=\""+data.item.id+'" /></div></li>')},removeSelectedElem:function(data){console.log(data)},handleAutoCompleteEvents:function(data){$(".m-form-auto-close").live("click",function(){var eventname=$(this).attr("data-events");console.log($(this).html());var currObjId=$(this).parents("li").parents("li").find("input").attr("id");var num_of_elements=$(this).parents("li").parents("li").find("input").attr("data-num-elements");var arr2=eventname.split("=");var events2=arr2[1];var sel_id=$(this).parents("li.selected_elem").attr("data-selected");var sel_value=$(this).parents("li.selected_elem").find(".elem_text").html();var ul=$(this).parents("ul.result_container");$(this).parents("li.selected_elem").remove();if((num_of_elements&&(ul.find(".selected_elem").length<num_of_elements))||!num_of_elements){$("#"+currObjId).show()}if(events2){var dataObj="{id : "+sel_id+', value : "'+sel_value+'"}';eval(events2+"("+dataObj+")")}return false});$.ui.autocomplete.prototype._renderItem=function(ul,item){var html=Autocomplete.defaultRenderCallback(this.term,item);if(!html){return}return $("<li id='"+item.id+"'></li>").data("item.autocomplete",item).append("<a style='cursor: pointer;'>"+html+"<div class='clear'></div></a>").appendTo(ul)}},getSelectedIds:function(currObjId){var selected_ids=new Array();$("#"+currObjId).parent().find(".result_container > li.selected_elem").each(function(event,html){var sel_val=$(html).attr("data-selected");selected_ids.push(parseInt(sel_val))});selected_ids=$.unique(selected_ids);return selected_ids},defaultRenderCallback:function(term,item){if(item.render_callback){return item.render_callback(term,item)}var re=new RegExp(term,"i");var t=item.label.replace(re,"<span class='higlight_text'>"+term+"</span>");var description=(item.description)?"<br /><span class='desc'>"+item.description+"</span>":"";var appendItem=(item.img)?"<div class='autocomplete_img_cont'><img src='"+item.img+"' /></div><div class='match_text'>"+t+description+"</div>":"<div class='match_text'>"+t+description+"</div>";return appendItem}};Autocomplete.handleAutoCompleteEvents();manu.form={validateForm1:function(form){if(gDisableJSValidation){return true}var form=$(form);var form_id=form.attr("id");var validateRules=gValidateRules1["f_"+form_id];var ret=true;form.find(".clear-default").each(function(){if($(this).val()==$(this).attr("data-default")){$(this).val("")}});for(var elem in validateRules){var elemRules=validateRules[elem];if(elemRules!=null){ret1=this.validateElem1(form,elem,elemRules);ret=ret&&ret1}}if(!ret){form.find(".clear-default").each(function(){if($(this).val()==""){$(this).val($(this).attr("data-default"))}});return ret}if(form.find("input[name='_submit']").length==0){form.append('<input type="hidden" name="_submit" value="'+form_id+'" />')}return ret},validateElem1:function(form,elem,rules){jform=$(form);jelem=jform.find(":input[name='"+elem+"']");if(jelem.length==0){jelem=jform.find(":input[name='"+elem+"[]']")}if(jelem.attr("type")=="checkbox"||jelem.attr("type")=="radio"){jelem=jelem.filter(":checked")}jelem=jelem.last();for(var id in rules.rules){var rule=rules.rules[id];var type=rule.name;var args=rule.args;var msg=rule.msg;if(!manu.form.validateElemType(jform,jelem,type,args)){manu.validation.displayMessage("f_"+jform.attr("id"),"-e-"+elem,msg,"E","");return false}}return true},validateElemType:function(jform,jelem,type,args){if(type=="alphanumeric"){if(jelem.val().match(/[^\d\w]/i)){return false}}else{if(type=="postalcode"){if(jelem.val().match(/[^\d\w\s-]/i)){return false}}else{if(type=="minLength"){if(jelem.val().length<args[0]){return false}}else{if(type=="maxLength"){if(jelem.val().length>args[0]){return false}}else{if(type=="matchOther"){var jOther=jform.find(":input[name='"+args[0]+"']");if(jelem.val()!=jOther.val()){return false}}else{if(type=="ip"){var bytes=jelem.val().split(".");if(!bytes||bytes.length!=4){return false}for(var i in bytes){var byte1=bytes[i];if(isNaN(byte1)||byte1<0||byte1>255){return false}}}else{if(type=="email"){return/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/i.test(jelem.val())}else{if(type=="required"){if(jQuery.trim(jelem.val())==""){return false}}}}}}}}}return true},handleFormEvents:function(form_id){var form=$("#"+form_id);if(form.hasClass("m-auto-submit")){form.find("input").keyup(function(event){if(event){keycode=event.which}else{if(window.event){keycode=window.event.keyCode}else{return false}}if(keycode==13){form.submit()}return true})}if(form.hasClass("m-ui-support")){form.find("input:submit,button").button()}form.find(".m-form-dp").each(function(){var dateVal=new Date($(this).val());var options={dateFormat:"yy-mm-dd",defaultDate:dateVal};$(this).datepicker(options)});form.find(".clear-default").each(function(){if($(this).val()==""){$(this).val($(this).attr("data-default"))}$(this).focus(function(){if($(this).val()==$(this).attr("data-default")){$(this).val("")}}).blur(function(){if($(this).val()==""){$(this).val($(this).attr("data-default"))}})});form.find(".orig_password").blur(function(){if($(this).val()==""){$(this).hide();$(this).prev().show()}});form.find(".text_password").focus(function(){$(this).hide();$(this).next().show().focus()});form.find(":input,a").andSelf().each(function(){var events=$(this).attr("data-events");if(events){var arr1=events.split(";");for(var i in arr1){var events1=arr1[i];var arr2=events1.split("=");var name=arr2[0];var events2=arr2[1];var arr3=events2.split(",");for(var i in arr3){$(this).bind(name,eval(arr3[i]));if($(this).attr("data-trigger")){$(this).trigger(name)}}}}});form.find(".m-form-fcbk").each(function(){var url=$(this).attr("data-source-action");var options={input_default_class:$(this).attr("data-input-class"),holder_class:$(this).attr("data-holder-class"),json_url:url,json_cache:false,number_of_elements:1,onselect:$(this).attr("data-select-handler"),onremove:$(this).attr("data-remove-handler"),holder_exists:"#"+$(this).attr("id")};$(this).fcbkcomplete(options)});form.find(".m-form-autocomplete").each(function(){var url=$(this).attr("data-source-action");var render_callback=$(this).attr("data-render-handler");var no_of_elements=$(this).attr("data-num-elements");var skip_img_select=$(this).attr("data-skip-imgselect");var hide_input=$(this).attr("data-hide-input");var currObjId=$(this).attr("id");$(this).autocomplete({source:function(request,response){var selected_ids=Autocomplete.getSelectedIds(currObjId);Global.getJSONAction(url,{term:request.term,selectedIds:selected_ids},function(data){var responseItems=data.response.items;if(!responseItems.length){var no_records="";no_records={id:0,value:"No records found",label:"No records found"};responseItems.push(no_records)}response($.map(responseItems,function(item){return{id:item.id,label:item.label,value:item.text,description:item.description,img:item.img,render_callback:render_callback}}))})},selectFirst:true});$(this).autocomplete("option","select",function(event,data){var add_callback=$(this).attr("data-select-handler");var remove_callback=$(this).attr("data-remove-handler");var skipadd=$(this).attr("data-skip-select");var selected_ids=Autocomplete.getSelectedIds(currObjId);event.preventDefault();$(this).val("");if((hide_input&&(no_of_elements&&(no_of_elements==(selected_ids.length+1))))||(hide_input&&!no_of_elements)){$(this).hide()}if(!data.item.id||(no_of_elements&&(no_of_elements==selected_ids.length))){return}if(!skipadd){var elem_name=$(this).attr("name");Autocomplete.handleSelectItem($(this),data,elem_name,remove_callback,skip_img_select)}if(add_callback){var dataObj='{id : "'+data.item.id+'", value : "'+data.item.value+'"}';eval(add_callback+"("+dataObj+")");return}})})},editAreaChanged:function(id){$("#"+id).val(editAreaLoader.getValue(id));return true},getCallback:function(elem,type){var callback=$(elem).attr("data-cb-"+type);if(callback){callback=eval(callback);if(!callback){throw"callback "+$(elem).attr("data-cb-"+type)+" is not a valid function"}}else{callback=function(){}}return callback},submitRegularForm:function(){var form_id=$(this).attr("id");manu.form.clearFormMessages(form_id);var ret=manu.form.validateForm1(this);if(!ret){return ret}return true},submitAjaxForm:function(){var form_id=$(this).attr("id");manu.form.clearFormMessages(form_id);var success_cb=manu.form.getCallback(this,"success");var error_cb=manu.form.getCallback(this,"error");var complete_cb=manu.form.getCallback(this,"complete");var ret=manu.form.validateForm1(this);if(!ret){return ret}$(this).ajaxSubmit({dataType:"json",success:function(data){var error_flag=false;manu.executePendingJs();var formMessages=gMessages["f_"+form_id];for(var i in formMessages){if(formMessages[i]["type"]=="E"){error_flag=true}}if(data.status==-1){error_flag=true}if(success_cb&&!error_flag){success_cb(data)}if(error_cb&&error_flag){error_cb(data)}if(complete_cb){complete_cb(data)}},error:error_cb});return false},clearForm:function(){return this.each(function(){$(":input",this).each(function(){var type=this.type,tag=this.tagName.toLowerCase();if(type=="text"||type=="password"||tag=="textarea"){this.value=""}else{if(type=="checkbox"||type=="radio"){this.checked=false}else{if(tag=="select"){this.selectedIndex=-1}}}})})},formReset:function(frm){for(var i=0;i<frm.elements.length;i++){if(!(frm.elements[i].type&&frm.elements[i].type=="submit"||frm.elements[i].type=="button"||frm.elements[i].type=="hidden")){if(frm.elements[i].type=="radio"||frm.elements[i].type=="checkbox"){frm.elements[i].checked=false}else{if(frm.elements[i].type=="select-one"){frm.elements[i].selectedIndex=-1}else{frm.elements[i].value=""}}}}},clearFormMessages:function(form_id){gMessages["f_"+form_id]={};var action=$("#"+form_id).attr("data-targetaction").toLowerCase().replace(/[^a-z_\-\.]+/gi,"_");$(".m-alert, .m-alertbox").each(function(){if(!this.className.match("m_f_"+form_id+"-")&&!this.className.match("m_"+action+"-")){return}$(this).html("");$(this).hide()})},submitForm:function(){var form=$(this).parents("form");form.submit()},testCallback:function(data){alert("successfully called callback function")}};$.fn.clearForm=manu.form.clearForm;manu.uploader={fileProcessing:[],progressTimeout:"",checkFileUploadDone:function(e){$("#file_error").hide();if(manu.uploader.fileProcessing.length>0){$("#file_error").show();e.stopImmediatePropagation();return false}return true},handleAddedImage:function(file_obj,cont_id){var container=$("#"+cont_id);container.find("iframe, file_status").hide();container.find(".file_path").val(file_obj.file_id).attr("checked","checked");container.find(".file_name").html(file_obj.file_name);container.find(".file_content img").attr("src",file_obj.file_path);container.find(".file_path_link").val(file_obj.file_name+"~~"+file_obj.file_path);container.find(".file_content").show();container.find("#file_id").css("width","15px");container.find(".file_content").removeClass("hidden")},toggleIframeFileObject:function(){$(".file_path").live("click",function(){var curr_obj=$(this).parents(".iframe_cont");curr_obj.find(".file_path").val("");curr_obj.find(".file_name").html("");curr_obj.find(".file_content img").attr("src","");curr_obj.find(".file_content").hide();curr_obj.find("iframe, file_status").show();return false})},fileUploadStarted:function(cont_id){manu.uploader.fileProcessing.push(cont_id);var container=$("#"+cont_id);container.find(".m-file-uploading").show();container.find(".m-file-error").hide();container.find(".m-file-error img").attr("title","");if(container.find(".m-file-progressbar").length>0){if(manu.uploader.progressTimeout){clearTimeout(manu.uploader.progressTimeout)}container.find(".m-file-progressbar").progressbar({value:0}).show();setTimeout(function(){manu.uploader.updateProgressBar(cont_id)},1000)}},updateProgressBar:function(cont_id){var container=$("#"+cont_id);manu.uploader.progressTimeout=setTimeout(function(){manu.uploader.updateProgressBar(cont_id)},1000);jQuery.get("/uploadStat.php",{key:cont_id},function(data){container.find(".m-file-progressbar").progressbar("option","value",parseInt(data))})},stopProgressBar:function(cont_id){if(manu.uploader.progressTimeout){clearTimeout(manu.uploader.progressTimeout)}var container=$("#"+cont_id);container.find(".m-file-progressbar").progressbar("option","value",0);container.find(".m-file-progressbar").hide()},fileUploadSuccess:function(cont_id,data){manu.uploader.stopProgressBar(cont_id);var container=$("#"+cont_id);manu.uploader.fileProcessing=jQuery.grep(manu.uploader.fileProcessing,function(value){return value!=cont_id});container.find(".m-file-uploading").hide();if(!data.response.success){var msgs=[];for(i in data.messages){msgs.push(data.messages[i].msg)}manu.log(msgs.join(","));return}manu.uploader.handleAddedImage(data.response,cont_id)},fileUploadFailed:function(cont_id,data){manu.uploader.stopProgressBar(cont_id);var container=$("#"+cont_id);container.find(".m-file-uploading").hide();var errors=[];if(data.messages){for(var i in data.messages){errors.push(data.messages[i].msg)}container.find(".m-file-error").attr("title",errors.join("<br/>"))}container.find(".m-file-error").show()}};var AppCms={setSlidePage:function(){var curSelection=$(this).val();if(curSelection=="t-shirt"){$("select[name=data[product_id]]").parent("li").show()}else{$("select[name=data[product_id]]").parent("li").hide()}}};var fileProcessing=[];$(function(){$(".state_block").hide();if($("#recaptcha_holder").length){Recaptcha.create("6Ld5IwkAAAAAAM55ClRMNzlAyItw4m_8_lYkqCb9","recaptcha_holder",{theme:"red",tabindex:0,callback:Recaptcha.focus_response_field})}$("select[name=country]").change(function(){if($(this).val()!="US"){$(".state_block").hide()}else{$(".state_block").show()}});$("#submit_artwork").live("click",function(){if(elemClicked==1){return false}elemClicked=1;$(this).closest("form").submit();return});$(".auth").live("click",DBH.authHandler);$(".disable_button").live("click",function(event){event.stopImmediatePropagation();return false})});var DBH={checkFileUploadDone:function(e){$("#file_error").hide();if(fileProcessing.length>0){$("#file_error").show();e.stopImmediatePropagation();return false}return true},authElementClicked:null,FCBKComplete:function(jelem,options){jelem.fcbkcomplete(options)},handleAddedImage:function(file_obj,cont_id){var curr_container=$("#"+cont_id);curr_container.find("iframe").hide();curr_container.find(".file_path").val(file_obj.file_id).attr("checked","checked");curr_container.find(".file_name").html(file_obj.file_name);curr_container.find(".file_path_link").val(file_obj.file_name+"~~"+file_obj.file_path);curr_container.find(".file_content").show()},toggleIframeFileObject:function(){$(".file_path").live("click",function(){var curr_obj=$(this).parents(".iframe_cont");curr_obj.find(".file_path").val("").removeAttr("checked");curr_obj.find(".file_name").html("");curr_obj.find(".file_content").hide();curr_obj.find("iframe").show()})},authHandler:function(event){if(gIsLogged){return true}DBH.authElementClicked=this;if(!gIsLogged){$("#poplogin").trigger("click");event.stopImmediatePropagation();return false}else{if($(this).hasClass("quick-vote")){return true}else{if(!is_user_verified){Global.alertMsg("user_dont_have_privileges");event.stopImmediatePropagation();return false}}}},slideTrackMenu:function(){var top_check=$(".slide-track nav").offset().top-parseFloat($(".slide-track nav").css("marginTop").replace(/auto/,0));$(window).scroll(function(event){var y=$(this).scrollTop();if(y>=top_check){$(".slide-track nav").addClass("fixed")}else{$(".slide-track nav").removeClass("fixed")}})}};var Profile={handlePasswordChangeEvents:function(){$("#change_user_password").live("click",function(){Global.ajaxSubmitJSON("change_password_form",function(data){if(data.response.password_changed){$("#change_password_form").clearForm();$("#poplogin").trigger("click")}})})}};var Home={Slideshow:{timeout:"",count:5,currentIndex:0,init:function(){Home.Slideshow.count=$("#slideshow .slide").length;Home.Slideshow.currentIndex=0;Home.Slideshow.startSlide(Home.Slideshow.currentIndex);$("#slideshow .nav li a").click(function(){var index=$(this).parent("li").attr("data-index");$("#slideshow .nav li .inner").stop();$("#slideshow .slide").stop();Home.Slideshow.changeSlide(index);return false})},startSlide:function(index){$("#slideshow .nav li .inner").width(0);$("#slideshow .nav li[data-index="+index+"] .inner").animate({width:"190px"},10000,"linear",function(){Home.Slideshow.changeSlide(parseInt(index,10)+1)})},changeSlide:function(index){var currentIndex=Home.Slideshow.currentIndex;if(index>=Home.Slideshow.count){index=0}$("#slideshow .slide[data-index="+currentIndex+"]").fadeOut(500,function(){$("#slideshow .slide[data-index="+index+"]").fadeIn(500,function(){})});Home.Slideshow.startSlide(index);Home.Slideshow.currentIndex=index}},Badges:{init:function(){$("#news-module .container:last").addClass("last")}}};var Shop={handleShopEvents:function(){$("a.shop-filters").live("click",function(){var data_url=$(this).attr("data-url");Global.loadAction("#shop-filter-container","ShopFilter",{uri:data_url},function(){Global.loadAction("#main","ShowBrowseTees",{uri:data_url},function(){})});return false})},handleTeesToggle:function(){$("ul#product-types >li.blanks").live("click",function(){var params=$(this).attr("data-index").split("-");var category=params[0];var blank_id=params[1];var product_id=$("#product_id").val();var request_params={blank_id:blank_id,product_id:product_id,category:category};Global.loadAction("#display_image","ShopProductImage",request_params,function(data){});Global.loadAction("#gender_container","ShopGenderSpecifications",request_params,function(data){})})},handleShopCommonEvents:function(){$("#top").live("click",function(){window.scrollTo(0,0);return false})},commonValues:function(){var men=$("div.mens li").hasClass("selected");var gender;var women=$("div.womens li").hasClass("selected");if(men||women){if(men){gender="M"}else{if(women){gender="F"}}}var size=$(".gender").find("ul li.selected").text();var price=$(".price").find("ul li.selected").text();var color=$(".colors").find("ul li.selected").text();var details=new Array(gender,size,price,color);return details},handleProductDetailThumb:function(){$("ul#product-detail-thumbs li a.thumb").live("click",function(){if($(this).attr("data-big-img")===""){return false}var big_img=$(this).attr("data-big-img");var thumb_img=$(this).attr("data-thumb-img");$("#product-detail-thumbs .thumb").removeClass("curr-thumb-selected-img");$(this).addClass("curr-thumb-selected-img");if($(this).attr("data-gender")=="M"){$("img#women_image").parent().removeClass("show");$("img#women_image").removeClass("show");$("img#men_image").parent().addClass("show");$("img#men_image").addClass("show");$("img#men_image").parent("a").html(big_img);$("img#men_image").parent("a").attr("href",thumb_img.replace("-43x43",""))}else{if($(this).attr("data-gender")=="W"){$("img#women_image").parent().addClass("show");$("img#women_image").addClass("show");$("img#men_image").parent().removeClass("show");$("img#men_image").removeClass("show");$("img#women_image").parent("a").html(big_img);$("img#women_image").parent("a").attr("href",thumb_img.replace("-43x43",""))}else{if($(this).attr("data-gender")=="K"){$("img#kids_image").parent("a").html(big_img);$("img#kid_image").parent("a").attr("href",thumb_img.replace("-43x43",""))}}}return false})},handleReprint:function(){$(".stock-status").live("click",function(){var cur_elem=$(this);if(cur_elem.hasClass("stock-requested")){cur_elem.html("Thanks");return false}var product_id=cur_elem.attr("data-product-id");var subproduct_id=cur_elem.attr("data-subproduct-id");Global.getJSONAction("ReprintRequest",{product_id:product_id,subproduct_id:subproduct_id},function(data){if(!data.response.is_exist){cur_elem.addClass("stock-requested");cur_elem.html("Thanks")}else{cur_elem.addClass("stock-requested");cur_elem.html("Thanks")}})});$("section#gender_container dl dt.reprint-button").hover(function(){$(this).html("SOLD OUT")},function(){$(this).html($(this).attr("data-size"))})},handleFancybox:function(){$("a.img_main, a.img_alt").fancybox({transitionIn:"fade",transitionOut:"fade",speedIn:200,speedOut:100,overlayShow:true,overlayOpacity:0.8,overlayColor:"#000",padding:5,autoScale:false})}};var forum_elemClicked;var Discussion={handleUserDiscussions:function(){var comment_count=$("#comment_count").val();$("span.comment-count").attr("id",comment_count);$("span.comment-count").text(comment_count);$("#user_comment").live("focusin focusout",function(event){if(event.type=="focusin"){if($(this).val()=="Join the conversation! Type your comment here..."){$(this).val("")}}else{if(!$.trim($(this).val())){$(this).val("Join the conversation! Type your comment here...")}}});$(".discuss_reply").live("click",function(){var parent_container=$(this).parents(".comment");var reply_params=$(this).attr("id").split("_");var request_params={design_id:reply_params[0],product_id:reply_params[1],forum_id:reply_params[2],topic_id:reply_params[3],parent_post_id:reply_params[4]};Global.getAction("PostReplyForm",request_params,function(data){if(parent_container.next().find("#reply_comment").length>0){return}parent_container.after(data);parent_container.find("#reply_comment").focus()})});$("#cancel_reply").live("click",function(){$("a#submit_reply").parents("div.comment").remove()});$(".comment_reply").live("click",function(){var post_id=$(this).attr("data-postid");var poster=$(this).attr("data-postername");if(!post_id){return}if(!location.href.match(/#user_comment/)){window.location.href=location.href+"#user_comment"}else{window.location.href=location.href}var focus_point=0;if(poster&&poster.length){focus_point=(poster.length+3);$("#add-post-form").find("textarea").text("@"+poster+"  ")}var _elem=document.getElementById("user_comment");if(_elem.createTextRange){var range=_elem.createTextRange();range.collapse(true);range.moveEnd("character",focus_point);range.moveStart("character",focus_point);range.select()}else{if(_elem.setSelectionRange){_elem.focus();_elem.setSelectionRange(focus_point,focus_point);return false}}});$(".comment_reply_cancel").live("click",function(){$(this).parents("div.reply-container").find("div.error").html("").hide();$(this).parents("div.reply-container").hide()});$(".report-comment").live("click",function(){$("#report-comment-form").clearForm();var topic_id=$(this).attr("data-topic-id");var post_id=$(this).attr("data-post-id");var post_url=$(this).attr("data-post-url");var post_type=$(this).attr("data-post-type");if(!topic_id||!post_id||!post_url||!post_type){return}$("#report-comment-form").find("#topic_id").val(topic_id);$("#report-comment-form").find("#post_id").val(post_id);$("#report-comment-form").find("#post_url").val(post_url);$("#report-comment-form").find("#post_type").val(post_type);Global.dialog($("#report-comment-overlay"),{width:400,height:"auto",resizable:false});$(".m_forum_reportcomment-REST").html("");$("#report-comment-form textarea#report_message").val("")});$(".submit-report").live("click",function(){var msg_type="";var msg="";Global.ajaxSubmitJSON("report-comment-form",function(data){var post_id=data.response.post_id;if(data.response.is_success===true){msg_type="success";msg="Comment has been reported.";Global.closeDialog()}else{if(data.response.is_success===false){$("div#report-comment-error").html("");msg_type="error";msg="Comment report failed! Please try later.";$("div#report-comment-error").html(msg)}else{if(data.response.is_success=="comment required"){$("div#report-comment-error").html("");msg_type="error";msg="Please enter comment.";$("div#report-comment-error").html(msg)}}}if(msg){$("#comment-report-msg-"+post_id+" div").show();$("#comment-report-msg-"+post_id+" div").addClass(msg_type).html(msg);setTimeout(function(){$("#comment-report-msg-"+post_id+" div").hide();$("#comment-report-msg-"+post_id+" div").html("");$("#comment-report-msg-"+post_id+" div").removeClass(msg_type)},5000)}},function(data){if(data.messages.report_message_required.msg){}})});$(".comment_delete").live("click",function(){Global.closeDialog();var post_id=$(this).attr("data-postid");var poster_id=$(this).attr("data-posterid");var parent_id=$(this).attr("data-parent-id");var entity=$(this).attr("data-entity");var entity_id=$(this).attr("data-entity-id");var params={post_id:post_id,poster_id:poster_id,parent_id:parent_id,entity:entity,entity_id:entity_id};Global.getAction("ConfirmToDeleteMyPost",params,function(data){$("#delete-comment-overlay").html(data);Global.dialog($("#delete-comment-overlay"),{width:500,height:150,resizable:false,dialogClass:"cancile-confirm",modal:true,title:"",close:function(ev,ui){}})})});$("#action_btns_delete_div a#confirm-delete-post").live("click",function(){var post_id=$(this).parent("div").attr("data-post-id");var poster_id=$(this).parent("div").attr("data-poster-id");var parent_id=$(this).parent("div").attr("data-parent-id");var entity=$(this).parent("div").attr("data-entity");var entity_id=$(this).parent("div").attr("data-entity-id");Global.getJSONAction("DeleteMyPost",{post_id:post_id,poster_id:poster_id,entity:entity,entity_id:entity_id},function(data){if(data.response.is_deleted){Global.closeDialog();$("section#comment-"+parent_id).remove();var total_posts=$("div#counter-container").attr("data-counter-val");var remain_counter=(parseInt(total_posts,10)>0)?parseInt(total_posts,10)-1:0;var new_contents;if(entity=="FORUM"){new_contents=(remain_counter===0)?"No Comments - Add a Reply":((remain_counter>1)?remain_counter+" Replies":remain_counter+" Reply")}else{new_contents=(remain_counter===0)?"0 Comment":((remain_counter>1)?remain_counter+" Comments":remain_counter+" Comment")}$("div#counter-container h2").html(new_contents);$("div#counter-container").attr("data-counter-val",remain_counter)}})});$("#action_btns_delete_div a#dont-delete").live("click",function(){Global.closeDialog()});$("a.comment_edit").live("click",function(){var post_id=$(this).attr("data-postid");if($(this).hasClass("topic-comment")){$("div#edit-topic-comment-div-"+post_id).removeClass("frm_hide")}else{$("div #edit-comment-div-"+post_id).removeClass("frm_hide")}});$("#forum-detail #original-post a.delete-topic").live("click",function(){var topic_id=$(this).attr("data-topicid");Global.getAction("ConfirmToDeleteTopic",{topic_id:topic_id},function(data){$("#delete-comment-overlay").html(data);Global.dialog($("#delete-comment-overlay"),{width:500,height:150,resizable:false,dialogClass:"cancile-confirm",modal:true,title:"",close:function(ev,ui){}})})});$("#action_btns_delete_div a#confirm-delete-topic").live("click",function(){var topic_id=$(this).parent("div").attr("data-topicid");Global.getJSONAction("DeleteTopic",{topic_id:topic_id},function(data){if(data.response.is_deleted){Global.closeDialog();location.href=MAIN_URL+"forum"}})})},handleEditSuccess:function(data){var post_id=data.response.post_id;var topic_id=data.response.topic_id;var post_msg=data.response.post_msg;Global.getAction("FormatPost",{post_id:post_id},function(data){if(topic_id){var cur_post_class=".curr-topic-"+topic_id;$(cur_post_class).html(data);$("div#edit-topic-comment-div-"+post_id).addClass("frm_hide");$("form#topic_form_"+post_id+" textarea").val(post_msg)}else{$("form#form_"+post_id+" textarea").val(post_msg);$("div#article-"+post_id+" article").html(data);$("div#edit-comment-div-"+post_id).addClass("frm_hide")}})},handleReplySubmit:function(data){var comment_count=$("#comment_count").val();elemClicked=0;var parent_container=$("a#submit_reply").parents("div.comment");Global.getAction("ViewPosts",{post_id:data.response.post_id},function(data){parent_container.html(data)});comment_count++;$("span.comment-count").attr("id",comment_count);$("span.comment-count").text(comment_count)},handleCommentSubmit:function(){elemClicked=0;if(elemClicked==1){return false}elemClicked=1},commentSuccessHandler:function(){$("#add-post-form").clearForm();var params={post_entity_id:$("input[name='post_entity_id']").val()};if($(".message-detail").length>0){params.post_entity="PROFILE"}else{if($(".closet-detail").length>0){params.post_entity="CLOSET"}else{if($(".shop-detail").length>0){params.post_entity="PRODUCT"}else{if($(".vote-detail").length>0){params.post_entity="DESIGN"}else{if($(".forum-detail").length>0){params.post_entity="FORUM"}}}}}Global.loadAction("#view_posts","ShowComments",params,function(data){elemClicked=0})},commentErrorHandler:function(){elemClicked=0;Discussion.commentSuccessHandler()},disableAddReplyButton:function(){$("div.reply-container").find("form").find("#postit").addClass("disable_button")},replyAddSuccessHandler:function(data){var _elem=$("div.reply-container").find("form").find("#postit");if(_elem.hasClass("disable_button")){_elem.removeClass("disable_button")}var params={post_entity_id:$("input[name='post_entity_id']").val()};if($(".message-detail").length>0){params.post_entity="PROFILE"}else{if($(".closet-detail").length>0){params.post_entity="CLOSET"}else{if($(".shop-detail").length>0){params.post_entity="PRODUCT"}else{if($(".vote-detail").length>0){params.post_entity="DESIGN"}else{if($(".forum-detail").length>0){params.post_entity="FORUM"}}}}}Global.loadAction("#view_posts","ShowComments",params,function(data){})},replyAddErrorHandler:function(data){var elem=$("div.postbox-form").find("form").find("#postit");if(elem.hasClass("disable_button")){elem.removeClass("disable_button")}}};var Forum={handleForumActions:function(){$(".form_submit").live("click",function(){if(elemClicked==1){return false}elemClicked=1;$(this).closest("form").submit();$(this).attr("disabled","disabled").attr("style","background-color: silver; cursor: default;")});$("#cancel_add_post").live("click",function(){window.location.href=MAIN_URL+"forum"});$("div.header a").live("click",function(){var forum_type=$(this).attr("class").split(" ");$("div.header").children().removeClass("active");$(this).addClass("active");Global.loadAction("#forums_details","ForumByCategory",{forum_type:forum_type[0]},function(){})});$("a.load-more").live("click",function(){var last_post_date=$(this).attr("data-index");var forum_type=$("div.header a.active").attr("class").split(" ");$(this).remove();Global.getAction("ForumByCategory",{last_post_date:last_post_date,forum_type:forum_type[0]},function(data){$("#forums_details").find("div.thread:last").after(data)})})},handleFiltering:function(){$("div.sorting select.sort-forums").live("change",function(){var selected_option=$(this).val();var forum_slug=$("li.active div.header a").attr("data-slug");Global.loadAction("#forums_details","ForumByCategory",{orderby:selected_option,forum_slug:forum_slug})})},handlePostPreview:function(){var post_topic;var post_title;var post_message;var is_comment;$("a#post_preview").live("click",function(){if($(this).hasClass("comment-preview")){post_message=$("form#add-post-form textarea#user_comment").val();if(post_message==="Join the conversation! Type your comment here..."||post_message===""){return false}$("div#add_post div#comment-section").hide();post_title="";is_comment=1}else{post_topic=$("form#add-forum-post select#forum_id").val();post_title=$("form#add-forum-post input#topic_title").val();post_message=$("form#add-forum-post textarea#topic_description").val();if(!post_title||!post_message||!post_topic){return false}$("div#post-new-topic").hide();is_comment=0}Global.loadAction("#preview-new-topic","PreviewPost",{post_title:post_title,post_message:post_message,is_comment:is_comment},function(){});$("div#preview-new-topic").show()});$("a#close-post-preview").live("click",function(){if($(this).hasClass("comment-preview-close")){$("div#add_post div#comment-section").show();$("div#preview-new-topic").html("");$("div#preview-new-topic").hide()}else{$("div#post-new-topic").show();$("div#preview-new-topic").html("");$("div#preview-new-topic").hide()}})}};var elemClicked=0;var Login={handleLoginPopupEvents:function(){$("a#poplogin").click(function(){manu.form.clearFormMessages($("#login_cont").find("form").attr("id"));if($(this).attr("data-attr")=="inline"){manu.dialog($("#login_cont"),{width:350,resizable:false,modal:true,draggable:false});return false}})},redirectPage:function(data){if(data.response.success){Common.handleRedirectEvents(data)}},errorHandler:function(data){if(data.response.is_user_verified){Login.redirectPage(data)}}};var Register={showRegisterOverlayWindow:function(){$("a#popregister, #dbh-welcome-popregister").click(function(){manu.form.clearFormMessages($("#register_cont").find("form").attr("id"));if($(this).attr("data-attr")=="inline"){manu.dialog($("#register_cont"),{width:500,resizable:false,modal:true,draggable:false});return false}})},handleUsernameChange:function(){var user_name=$.trim($(this).val()).length;if($(this).val().match(/[^\d\w]/i)){$("#user_avail").html("<font color='red'>Not available</font>")}else{if(user_name>0&&user_name<4){$("#user_avail").html("<font color='red'>Too short</font>");return}else{if(user_name>15){$("#user_avail").html("<font color='red'>Too long</font>");return}else{if(user_name>=3&&user_name<=15){Register.checkAvailability($(this).val());return}else{$("#user_avail").html("")}}}}},handlePasswordChange:function(){var pass=$.trim($(this).val()).length;if(pass>0&&pass<6){$("#pass_avail").html("<font color='red'>Too short</font>")}else{if(pass>=6&&pass<=20){Register.checkStrength()}else{$("#pass_avail").html(" ")}}},checkNormalRegisterPasswords:function(){$("#conf_pwd").live("blur",function(){var password=$.trim($("#pwd_register").val());var re_pass=$.trim($("#conf_pwd").val());if(re_pass&&(password!=re_pass)){$("#password_mismatch").html("<font color='red'>Passwords do not match</font>");$("#password_mismatch").show()}else{if(!re_pass||(re_pass&&(password==re_pass))){$("#password_mismatch").text("")}}})},redirectPage:function(data){if(data.response.success){Common.handleRedirectEvents(data)}},errorHandler:function(data){if(data.response.register){Register.redirectPage(data)}},checkAvailability:function(username){Global.getJSONAction("CheckUserAvailability",{username:username},function(data){$("#user_avail").html(data.response.msg);$("#user_avail").show()})},checkStrength:function(){$("#pass_avail").html(Register.passwordStrength($(this).val(),$("input[name='user_name']").val()))},passwordStrength:function(password,username){if(!password){return}var defaultstr="Strength:";var badPass=defaultstr+" <span class='red'>Bad</span>";var goodPass=defaultstr+" <span class='green'>Good</span>";var strongPass=defaultstr+" <span class='green'>Strong</span>";var score=0;if(password.toLowerCase()==username.toLowerCase()){return badPass}score+=password.length*6;score+=(Register.checkRepetition(1,password).length-password.length)*1;score+=(Register.checkRepetition(2,password).length-password.length)*1;score+=(Register.checkRepetition(3,password).length-password.length)*1;score+=(Register.checkRepetition(4,password).length-password.length)*1;if(password.match(/(.*[0-9].*[0-9].*[0-9])/)){score+=5}if(password.match(/(.*[!,@,#,$,%,\^,&,*,?,_,~].*[!,@,#,$,%,\^,&,*,?,_,~])/)){score+=5}if(password.match(/([a-z].*[A-Z])|([A-Z].*[a-z])/)){score+=10}if(password.match(/([a-zA-Z])/)&&password.match(/([0-9])/)){score+=15}if(password.match(/([!,@,#,$,%,\^,&,*,?,_,~])/)&&password.match(/([0-9])/)){score+=15}if(password.match(/([!,@,#,$,%,\^,&,*,?,_,~])/)&&password.match(/([a-zA-Z])/)){score+=15}if(password.match(/^\w+$/)||password.match(/^\d+$/)){score-=10}if(score<0){score=0}if(score>100){score=100}if(score<34){return badPass}if(score<68){return goodPass}return strongPass},checkRepetition:function(pLen,str){var res="";for(var i=0;i<str.length;i++){var repeated=true;for(var j=0;j<pLen&&(j+i+pLen)<str.length;j++){repeated=repeated&&(str.charAt(j+i)==str.charAt(j+i+pLen))}if(j<pLen){repeated=false}if(repeated){i+=pLen-1;repeated=false}else{res+=str.charAt(i)}}return res}};var Common={handleSelectedProduct:function(data){location.href=data.id},handleRedirectEvents:function(data){is_user_verified=data.response.is_user_verified;if(is_user_verified===0){manu.getAction("CheckUserVerificationStatus",{},function(data){$(".show_verification_msg").replaceWith(data)})}manu.closeDialog();if($(".register").length>0){location.href=MAIN_URL+"home";return}manu.getAction("ShowTopNavigations",{curraction:$("body").attr("class")},function(data){$("#site-actions").html(data)});gIsLogged=true;if(DBH.authElementClicked!==null){if(!DBH.authElementClicked.href.match(/javascript|#/)){window.location.href=DBH.authElementClicked.href;return}$(DBH.authElementClicked).click()}}};var Search={handleSearchResult:function(item){$("div.header").children().removeClass("active");manu.loadAction("#forums_details","ForumByCategory",{topic_id:item._value},function(){})}};var Design={handleSubmitDesignEvents:function(){$("dd").serialScroll({items:"a, p",duration:"150",axis:"y"});$(".more-info-btn").click(function(event){event.preventDefault();$(this).closest("dl").children("dd").trigger("next")});$(".choose-contest").click(function(event){$.scrollTo("#submit-info-scroll",500,{onAfter:function(){$("#submit-info").animate({height:"405"},function(){$(this).children().fadeIn(1000)})}})});$(".submit-form-next").click(function(event){$.scrollTo("#upload-art-scroll",500,{onAfter:function(){$("#upload-art").animate({height:"195"},function(){$(this).children().fadeIn(1000)})}})});DBH.toggleIframeFileObject()},submitDesign:function(){$("a.choose-contest").live("click",function(){var contest_id=$(this).attr("id");$("a.contest_type").removeClass("add_selection");$(this).addClass("add_selection");$("#contest_id").val(contest_id)});$("a.contest_type").live("mouseover",function(){$(this).addClass("add_border")});$("a.contest_type").live("mouseout",function(){$(this).removeClass("add_border")})},handleQuickVote:function(){$("#vote-section .submission").live("mouseover",function(){$(".quick-vote",this).stop().animate({top:"85"},100,"linear")});$("#vote-section .submission").live("mouseout",function(){$(".quick-vote",this).stop().animate({top:"107"},500,"linear")})},submitQuickVote:function(){$("a.quick-vote").live("click",function(){var designId=$(this).attr("data-design-id");if(!designId){return}Global.getJSONAction("QuickVote",{design_id:designId},function(data){})})},toggleImageByCategory:function(){$("div.upper ul.tabs li a").live("click",function(){if(!$(this).hasClass("selected")){if($(this).parent("li").attr("id")=="tab_artwork"){$("#tab_placement").find("a").removeClass("selected");$(this).addClass("selected");$("#display_image").find("div.img_alt").hide();$("#display_image").find("div.img_main").show()}else{if($(this).parent("li").attr("id")=="tab_placement"){$("#tab_artwork").find("a").removeClass("selected");$(this).addClass("selected");$("#display_image").find("div.img_main").hide();$("#display_image").find("div.img_alt").show()}}}})},submitVote:function(){$("#vote_container .votes .action").live("click",function(){var curr_obj=$(this);var design_id=curr_obj.attr("data-id");var vote_status=$("li#vote_button a div.vote-text-msg").attr("data-vote-status");Global.getJSONAction("QuickVote",{design_id:design_id,vote_status:vote_status},function(data){if(data.response.is_success){$("#vote_container .votes .total-vote-count").html("<span>: </span>"+data.response.vote+"<span> Vote(s)</span>")}if(data.response.is_voted){$("li#vote_button a div.vote-text-msg").html("<strong>Voted</strong>");$("li#vote_button a div.vote-text-msg").attr("data-vote-status",1)}else{$("li#vote_button a div.vote-text-msg").html("<strong>Vote for this Design</strong>");$("li#vote_button a div.vote-text-msg").attr("data-vote-status",0)}});return false});$("li#vote_button a.action").hover(function(){if($("li#vote_button a div.vote-text-msg").attr("data-vote-status")==1){$("li#vote_button a div.vote-text-msg").html("<strong>Unvote</strong>")}},function(){if($("li#vote_button a div.vote-text-msg").attr("data-vote-status")==1){$("li#vote_button a div.vote-text-msg").html("<strong>Voted</strong>")}});$("#copy_to_clip").live("click",function(){var textToClipBoard=document.getElementById("promote_this").innerHTML;var success=true;if(window.clipboardData){window.clipboardData.setData("Text",textToClipBoard)}else{var forExecElement=Design.CreateElementForExecCommand(textToClipBoard);Design.SelectContent(forExecElement);try{document.execCommand("copy",false,null)}catch(e){try{netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect");document.execCommand("copy",false,null)}catch(e){success=false}}document.body.removeChild(forExecElement)}if(success){alert("The text is on the clipboard, try to paste it!")}else{alert("Your browser doesn't allow clipboard access!")}})},CreateElementForExecCommand:function(textToClipBoard){var forExecElement=document.createElement("div");forExecElement.style.position="absolute";forExecElement.style.left="-10000px";forExecElement.style.top="-10000px";forExecElement.textContent=textToClipBoard;document.body.appendChild(forExecElement);forExecElement.contentEditable=true;return forExecElement},SelectContent:function(element){var rangeToSelect=document.createRange();rangeToSelect.selectNodeContents(element);var selection=window.getSelection();selection.removeAllRanges();selection.addRange(rangeToSelect)},handleDesignFilters:function(){$("#design-show-sort-filter").live("click",function(){var params={contest_category:$(".design-contest-filter li.active a").attr("data-contest-category"),contest_id:$("hidden_contest_id").attr("data-contest-id"),contest_name:$(".design-contest-filter li.active a").attr("data-contest-name"),show_by:$("#show_category input:checked").val(),filter_by:$("#filter_category input:checked").val()};Global.loadAction("div#main","VoteDesign",params,function(){});return false});$("#filter-submissions div#show_category li input").live("click",function(){if($(this).val()=="NOT_VIEWED"){if($("li.filterby-mostview input").attr("checked")==true){$("li.filterby-mostrecent input").attr("checked","checked")}$("li.filterby-mostview").hide();$("li.filterby-mostvote").hide();$("li.filterby-mostcomment").hide();$("li.filterby-mylike").hide()}else{if($(this).val()=="NOT_VOTED"){if($("li.filterby-mostvote input").attr("checked")==true){$("li.filterby-mostrecent input").attr("checked","checked")}$("li.filterby-mostview").show();$("li..filterby-mostvote").hide()}else{$("li.filterby-mostview").show();$("li.filterby-mostvote").show();$("li.filterby-mostcomment").show();$("li.filterby-mylike").show()}}})},handleRipeUnRipe:function(){$(".ripe").live("click",function(){var data=$(this).attr("id").split("_");var design_id=data[1];Global.getJSONAction("UpdateRipe",{design_id:design_id,ripe:1},function(data){$("div#ripes dd").html(data.response.ripes);$("div#unripes dd").html(data.response.unripes)})});$(".unripe").live("click",function(){var data=$(this).attr("id").split("_");var design_id=data[1];Global.getJSONAction("UpdateRipe",{design_id:design_id,unripe:1},function(data){$("div#ripes dd").html(data.response.ripes);$("div#unripes dd").html(data.response.unripes)})})},showTermAndConditions:function(){$("#submit-new-design a.design-term-condition").live("click",function(){var title="Terms and conditions";Global.getAction("SubmitTermCondition",{},function(data){$("#design_submit_term_condition").html(data);Global.dialog($("#design_submit_term_condition"),{width:500,height:320,resizable:false,dialogClass:"sharte_term_condition",modal:true,title:title,close:function(ev,ui){}})})})}};var Profile={addFollowUser:function(){$("a.follow").live("click",function(){if(elemClicked==1){return false}elemClicked=1;var fid=$(this).attr("data-id");var fname=$(this).attr("data-name");Global.getJSONAction("FollowUser",{friend_id:fid},function(data){if(data.status){Global.loadAction("#profile-basic-detail","ProfileBasicDetails",{user_id:fid,user:fname});elemClicked=0}})});$("a.unfollow").live("click",function(){if(elemClicked==1){return false}elemClicked=1;var fid=$(this).attr("data-id");var fname=$(this).attr("data-name");Global.getJSONAction("UnfollowUser",{friend_id:fid},function(data){if(data.status){Global.loadAction("#profile-basic-detail","ProfileBasicDetails",{user_id:fid,user:fname});elemClicked=0}})})},friendEventHandler:function(){$(".friend-unfollow").live("click",function(){if(elemClicked==1){return false}elemClicked=1;var parent=$(this).parent("li");var num_children=$(this).parent("li").parent("ul").children().length;var fid=$(this).attr("data-id");var fname=$(this).attr("data-name");Global.getJSONAction("UnfollowUser",{friend_id:fid},function(data){if(data.status){parent.fadeOut("slow",function(){if(num_children-1){parent.remove();$("#friends-mutual").find("h2").text("Friends: "+(num_children-1))}else{Global.loadAction("#friends-mutual","MutualFriends",{})}Global.loadAction("#friends-followers","FollowerUsers",{});elemClicked=0})}})});$(".following-unfollow").live("click",function(){if(elemClicked==1){return false}elemClicked=1;var parent=$(this).parent("li");var num_children=$(this).parent("li").parent("ul").children().length;var fid=$(this).attr("data-id");var fname=$(this).attr("data-name");Global.getJSONAction("UnfollowUser",{friend_id:fid},function(data){if(data.status){parent.fadeOut("slow",function(){if(num_children-1){parent.remove();Global.loadAction("#friends-following","FollowingUsers",{})}else{Global.loadAction("#friends-following","FollowingUsers",{})}elemClicked=0})}})});$(".follower-follow").live("click",function(){if(elemClicked==1){return false}elemClicked=1;var parent=$(this).parent("li");var num_children=$(this).parent("li").parent("ul").children().length;var fid=$(this).attr("data-id");var fname=$(this).attr("data-name");Global.getJSONAction("FollowUser",{friend_id:fid},function(data){if(data.status){parent.fadeOut("slow",function(){if(num_children-1){parent.remove();Global.loadAction("#friends-followers","FollowerUsers",{})}else{Global.loadAction("#friends-followers","FollowerUsers",{})}Global.loadAction("#friends-mutual","MutualFriends",{});elemClicked=0})}})})},handleQuickLinks:function(){$(".shop-img-wrapper").live("mouseover",function(){$(".quick_links",this).show()});$(".shop-img-wrapper").live("mouseout",function(){$(".quick_links",this).hide()});$("div.quick_links > ul > li >a").live("mouseover",function(){$(this).parent().addClass("add_shop_selction")});$("div.quick_links > ul > li >a").live("mouseout",function(){$(this).parent().removeClass("add_shop_selction")});$(".galBox_ul,.favBox_ul,.subBox_ul").live("mouseover",function(){$(".quick_gal_links",this).show()});$(".galBox_ul,.favBox_ul,.subBox_ul").live("mouseout",function(){$(".quick_gal_links",this).hide()});$("div.quick_gal_links > ul > li > a").live("mouseover",function(){$(this).parent().addClass("add_gal_selction")});$("div.quick_gal_links > ul > li > a").live("mouseout",function(){$(this).parent().removeClass("add_gal_selction")});$(".add_to_fav, .remove_fav").live("click",function(){var _elem=$(this);var category=_elem.attr("data-id").split("_");var design_id;var product_id;var gallery_id;var closet_id;var post_id;if(category[0]=="design"){design_id=category[1]}else{if(category[0]=="product"){product_id=category[1]}else{if(category[0]=="gallery"){gallery_id=category[1]}else{if(category[0]=="closet"){closet_id=category[1]}else{if(category[0]=="post"){post_id=category[1]}}}}}var request_params={design_id:design_id,product_id:product_id,gallery_id:gallery_id,closet_id:closet_id,post_id:post_id};var action_name=($(this).hasClass("remove_fav"))?"RemoveFavorites":"AddToFavorites";Global.getJSONAction(action_name,request_params,function(data){if(data.response.design){$(".sidebar .watchers dd").html(data.response.favorites);_elem.attr("title",data.response.favorites+" Likes")}else{if(data.response.closet){_elem.attr("title",data.response.favorites+" Likes")}else{if(data.response.post){_elem.parents("div.right").find("span.likes").html("&nbsp;&nbsp;"+data.response.favorites+" Likes");_elem.attr("title",data.response.favorites+" Likes")}else{if(data.response.product){_elem.attr("title",data.response.favorites+" Likes")}}}}if(data.response.design||data.response.closet||data.response.post||data.response.product){if(_elem.hasClass("remove_fav")){_elem.removeClass("remove_fav").addClass("add_to_fav");_elem.html("Like")}else{_elem.removeClass("add_to_fav").addClass("remove_fav");_elem.html("Unlike")}}if(product_id){Global.loadAction("#product-users","ProductUsers",{product_id:product_id},function(data){})}});return false});$("ul.sidebar-interact li a.common-overlay-link").live("click",function(){var curUrl=$(location).attr("href");var pageContent='<div class="curr-page-link"><input type="text" value="'+curUrl+'" /></div>';$("#show-link-in-popup").html(pageContent);Global.dialog($("#show-link-in-popup"),{width:400,height:115,resizable:false,dialogClass:"",modal:true,title:"Here is your link!",close:function(ev,ui){}});$("input").select();$("input").click(function(){$(this).select()})})},handleUserGalleryEvents:function(){$("#gallery_submit").live("click",function(){Global.ajaxSubmitAction("new_design",function(data){$(this).attr("disabled","disabled").attr("style","background-color: silver; cursor: default;")})});$("#upload_new_image").live("click",function(){Global.loadAction("#user_gallery_details","AddImageToGallery",{},function(data){})});$(".edit_title").live("click",function(){var curObj=$(this);var category=curObj.attr("id").split("_");var title=$("#title_"+category[1]).text();Global.loadAction("#title_"+category[1],"EditUserGallery",{gallery_id:category[1],edit:1,title:title},function(data){})});$(".save_title").live("click",function(){var gallery_id=$(this).attr("data-index");var title=$("#gal_title_"+gallery_id).val();Global.getJSONAction("EditUserGallery",{gallery_id:gallery_id,title:title,save_title:1},function(data){if(data.response.status){$("#title_"+gallery_id).text(title)}})})},removeFromGallery:function(){$(".remove_frm_gallery").live("click",function(){var curObj=$(this);var category=curObj.attr("data-index");Global.getJSONAction("EditUserGallery",{design_id:category[1],remove:1},function(data){curObj.parents("li").remove()})})},handleCopyAddressing:function(){$("#copy_address").live("click",function(){$("#ship_first_name").val($("#billing_first_name").val());$("#ship_last_name").val($("#billing_last_name").val());$("#ship_add1").val($("#billing_add1").val());$("#ship_add2").val($("#billing_add2").val());$("#ship_city").val($("#billing_city").val());$("#ship_state").val($("#billing_state").val());$("#ship_zip_code").val($("#billing_zip_code").val());$("#ship_country").val($("#billing_country").val())})},handleLinkForSubmissions:function(){$("div.user_submission_image").live("mouseover",function(){$(".quick_sub_links",this).show()});$("div.user_submission_image").live("mouseout",function(){$(".quick_sub_links",this).hide()})},changeProfilePicture:function(){Global.loadAction("#profile-basic-section","ProfileBasicDetails",{},function(data){})},closetDesignSelectHandler:function(){$(".recent-purchases-list").attr("checked",false);$(".recent-purchases-list").attr("disabled",true)},closetDesignRemoveHandler:function(){$(".recent-purchases-list").attr("checked",false);$(".recent-purchases-list").removeAttr("disabled")},handleStatesList:function(){$("select[name=country]").live("change",function(){var form_id=$(this).parents("form").attr("id");if($(this).val()=="US"){$("#"+form_id+" input[name=state_input]").addClass("hidden_shipping_state");$("#"+form_id+" select[name=state_list]").removeClass("hidden_shipping_state")}else{$("#"+form_id+" input[name=state_input]").removeClass("hidden_shipping_state");$("#"+form_id+" select[name=state_list]").addClass("hidden_shipping_state")}});$("#same-as-shipping").live("click",function(){if($(this).is(":checked")){$("#editBillingInfo input[name=first_name]").val($("#editShippingInfo input[name=first_name]").val());$("#editBillingInfo input[name=last_name]").val($("#editShippingInfo input[name=last_name]").val());$("#editBillingInfo input[name=address_one]").val($("#editShippingInfo input[name=address_one]").val());$("#editBillingInfo input[name=address_two]").val($("#editShippingInfo input[name=address_two]").val());$("#editBillingInfo input[name=city]").val($("#editShippingInfo input[name=city]").val());$("#editBillingInfo select[name=country]").val($("#editShippingInfo select[name=country]").val());$("#editBillingInfo input[name=state_input]").val($("#editShippingInfo input[name=state_input]").val());$("#editBillingInfo select[name=state_list]").val($("#editShippingInfo select[name=state_list]").val());$("#editBillingInfo input[name=zip_code]").val($("#editShippingInfo input[name=zip_code]").val());$("#editBillingInfo input[name=phone_number]").val($("#editShippingInfo input[name=phone_number]").val());if($("#editBillingInfo select[name=country]").val()=="US"){$("#editBillingInfo input[name=state_input]").addClass("hidden_shipping_state");$("#editBillingInfo select[name=state_list]").removeClass("hidden_shipping_state")}else{$("#editBillingInfo input[name=state_input]").removeClass("hidden_shipping_state");$("#editBillingInfo select[name=state_list]").addClass("hidden_shipping_state")}}else{$("#editBillingInfo input[name=first_name]").val("");$("#editBillingInfo input[name=last_name]").val("");$("#editBillingInfo input[name=address_one]").val("");$("#editBillingInfo input[name=address_two]").val("");$("#editBillingInfo input[name=city]").val("");$("#editBillingInfo select[name=country]").val("US");$("#editBillingInfo input[name=state_input]").val("");$("#editBillingInfo select[name=state_list]").val("");$("#editBillingInfo input[name=zip_code]").val("");$("#editBillingInfo input[name=phone_number]").val("");$("#editBillingInfo input[name=state_input]").addClass("hidden_shipping_state");$("#editBillingInfo select[name=state_list]").removeClass("hidden_shipping_state")}})},handleOrderEvents:function(){$("#order_history a.cancel_order").live("click",function(){Global.closeDialog();var order_id=$(this).attr("data-order-id");$("#order_cancel_confirm div#action_btns_div").attr("data-order-id",order_id);$("#order_cancel_confirm").removeClass("hidden-elem");Global.dialog($("#order_cancel_confirm"),{width:450,height:150,resizable:false,dialogClass:"cancile-confirm",modal:true,title:"",close:function(ev,ui){}});$(".ui-dialog-titlebar-close").remove()});$("#action_btns_div a#dont_cancel_order").live("click",function(){$("#cancel_order_popup").addClass("hidden-elem");Global.closeDialog()});$("#action_btns_div a#cancel_order").live("click",function(){var order_id=$(this).parent("div#action_btns_div").attr("data-order-id");var params={order_id:order_id,new_status:"CANCELLED"};Global.getJSONAction("ChangeOrderStatus",params,function(data){$("#order_cancel_confirm").addClass("hidden-elem");Global.closeDialog();Global.loadAction("div#order_history","OrderHistory",{},function(){})})});$("#order_history a.view_order").live("click",function(){var order_id=$(this).attr("data-order-id");Global.loadAction("#user_order_details","UserOrderDetails",{order_id:order_id},function(){$("#order_history").hide()});return false});$(".show_order_summary").live("click",function(){$("#user_order_details").html("");$("#order_history").show()})}};var ShoppingCart={handleCartEvents:function(){$("#gender_container .size .button").live("click",function(){var product_id=$(this).attr("data-product-id");var subproduct_id=$(this).attr("data-subproduct-id");if(!product_id||!subproduct_id){return}var gender=$(this).parent().parent("div.size").parent("div.wrapper").attr("data-gender");if(gender=="M"){$("img#women_image").parent().hide();$("img#women_image").hide();$("img#men_image").parent().show();$("img#men_image").show()}else{$("img#men_image").parent().hide();$("img#men_image").hide();$("img#women_image").parent().show();$("img#women_image").show()}Global.getAction("ShowCartOverlay",{product_id:product_id,subproduct_id:subproduct_id},function(data){Global.closeDialog();$("#cart_overlay_popup").html(data);Global.dialog($("#cart"),{width:450,height:290,modal:true,dialogClass:"checkout_overlay",draggable:false,resizable:false});$(".ui-dialog-titlebar-close").remove()})});$(".update_cart").live("click",function(){var cart_quantity=parseInt($("#site-actions .cart_quantity").text(),10);$("#site-actions .cart_quantity").text(cart_quantity+1);Global.closeDialog()});$(".cart_qty").live("change",function(){var quantity=$(this).val();if(quantity<1){$(this).val(1);quantity=1}var curr_obj=$(this);var data_info=$(this).parents("tr").attr("data-info").split("|");var params={subproduct_id:data_info[0],product_id:data_info[1],gender:data_info[2],size:data_info[3],quantity:quantity};Global.getJSONAction("StoreCartQuantity",params,function(data){$("#site-actions .cart_quantity").text(" "+data.response.cartQuantity+" ");Global.loadAction("#checkout_page #cart_overview","CartOverview",{},function(data){})})});$("#btn_remove").live("click",function(){var curr_obj=$(this);var data_info=$(this).parents("tr").attr("data-info").split("|");var params={type:"remove",subproduct_id:data_info[0],product_id:data_info[1],gender:data_info[2],size:data_info[3]};Global.getJSONAction("StoreCartQuantity",params,function(data){if(data.response.isRemoved){Global.loadAction("#checkout_page #cart_overview","CartOverview",{},function(data){})}})});$("#shippingDetails .shipping_country").live("change",function(){var country_code=$(this).val();if(country_code=="US"){$("#shippingDetails .shipping_state_input").hide();$("#shippingDetails .shipping_state").show()}else{$("#shippingDetails .shipping_state").hide();$("#shippingDetails .shipping_state_input").val("");$("#shippingDetails .shipping_state_input").show()}country_code=$("#shippingDetails .shipping_country").val();var state_code=$("#shippingDetails .shipping_state").val();var cart_params={shipping_country:country_code,shipping_state:state_code,country_change:1};Global.loadAction("#cart-sideview-container","CartSideview",cart_params,function(data){$("#checkout-total-balance").text($("#side-view-cart-details .total span").text());var shipping_params={shipping_country:country_code};Global.loadAction("#shipping-rates-container","ShippingRates",shipping_params,function(data){})})});$("#shippingDetails .shipping_state").live("change",function(){var country_code=$("#shippingDetails .shipping_country").val();var state_code=$("#shippingDetails .shipping_state").val();var params={shipping_country:country_code,shipping_state:state_code};Global.loadAction("#cart-sideview-container","CartSideview",params,function(data){$("#checkout-total-balance").text($("#side-view-cart-details .total span").text())})});toggle_payment_modes($("#billingDetails .billing_country").val());$("#billingDetails .billing_country").live("change",function(){var country_code=$(this).val();toggle_payment_modes(country_code)});function toggle_payment_modes(country_code){if(country_code=="US"){$("#billingDetails .billing_state_input").hide();$("#billingDetails .billing_state").show();$("input#payment_mode_0, label.payment_mode_0").show()}else{$("#billingDetails .billing_state").hide();$("#billingDetails .billing_state_input").val("");$("#billingDetails .billing_state_input").show();$("input#payment_mode_0, label.payment_mode_0, #payment-card-details").hide();$("input#payment_mode_1").attr("checked","checked")}}$(".shipping-service-radio").live("click",function(){var country_code=$("#shippingDetails .shipping_country").val();var state_code=$("#shippingDetails .shipping_state").val();var service_value=$(this).val().split("_");var params={type:"add_shipping",shipping_service_provider:service_value[0],shipping_service_name:service_value[1],shipping_service_cost:service_value[2],shipping_actual_cost:service_value[3],shipping_country:country_code,shipping_state:state_code};Global.loadAction("#cart-sideview-container","CartSideview",params,function(data){$("#checkout-total-balance").text($("#side-view-cart-details .total span").text())})});$("#submit_options_form").live("click",function(){$("#checkout-dialog").dialog({modal:true});$("#checkout-dialog").children(".wait").show();$(".ui-dialog-titlebar").hide();Global.getJSONAction("storeOrder",{},function(data){if(data.response&&data.response.errorMessage){var messageDialog=$("#checkout-dialog div.message");var msg=messageDialog.children(".msg");$("#checkout-dialog > div.message").children(".msg").text(data.response.errorMessage);$("#checkout-dialog > div:visible").hide();$("#checkout-dialog > div.message").show();return}$("#checkout-dialog > div:visible").hide();$("#checkout-dialog > div.redirect").show();window.location.href="payment"})});$("#place_cart_order").live("click",function(){Global.dialog($("#checkout-order-dialog"),{width:500,resizable:false,modal:true,draggable:false});$(".ui-dialog-titlebar").hide();$("#checkout-order-dialog").children(".wait-msg").show();var params={subscribe_newsletter:$("#dbh-notification").val(),dbh_referral:$("#dbh-referral-sources").val()};Global.getJSONAction("StoreOrder",params,function(data){if(data.response.success){$("#checkout-order-dialog > div:visible").hide();$("#checkout-order-dialog > div.redirect-msg").show();if($("#paypal-form").length>0){}else{window.location.href=MAIN_URL+"checkout/order"}}else{$("#checkout-order-dialog > div.error-msg").show()}})});$("#how-dbh-dollars-work").live("click",function(){var title="DBH Dollars";Global.getAction("HowDBHDolarWork",{},function(data){$("#how-shopping-cart-work").html(data);Global.dialog($("#how-shopping-cart-work"),{width:500,height:320,resizable:false,dialogClass:"shopping-cart-work",modal:true,title:title,close:function(ev,ui){}})})})},bindShippingDetails:function(){var params={address_one:$("#shippingDetails #shipping_address_one").val(),address_two:$("#shippingDetails #shipping_address_two").val(),city:$("#shippingDetails #shipping_city").val(),state:$("#shippingDetails #shipping_state").val(),zip:$("#shippingDetails #shipping_zip").val(),country:$("#shippingDetails #shipping_country").val()};Global.loadAction("#shipping-rates-container","ShippingRates",params,function(data){})},changeBillingAddress:function(){if($(this).is(":checked")){var country_code=$("#shippingDetails select[name='shipping_country']").val();var country_name=$("#billing_country option[value='"+country_code+"']").text();$("#uniform-billing_country span").text(country_name);$("#billingDetails input[name='billing_firstname']").val($("#shippingDetails input[name='shipping_firstname']").val());$("#billingDetails input[name='billing_lastname']").val($("#shippingDetails input[name='shipping_lastname']").val());$("#billingDetails input[name='billing_address_one']").val($("#shippingDetails input[name='shipping_address_one']").val());$("#billingDetails input[name='billing_address_two']").val($("#shippingDetails input[name='shipping_address_two']").val());$("#billingDetails input[name='billing_city']").val($("#shippingDetails input[name='shipping_city']").val());$("#billingDetails select[name='billing_state']").val($("#shippingDetails select[name='shipping_state']").val());$("#billingDetails input[name='billing_state_input']").val($("#shippingDetails input[name='shipping_state_input']").val());$("#billingDetails input[name='billing_zip']").val($("#shippingDetails input[name='shipping_zip']").val());$("#billingDetails select[name='billing_country']").val(country_code);$("#billingDetails input[name='billing_phone']").val($("#shippingDetails input[name='shipping_phone']").val());if(country_code=="US"){$("#billingDetails .billing_state_input").hide();$("#billingDetails .billing_state").show()}else{$("#billingDetails .billing_state").hide();$("#billingDetails .billing_state_input").show()}}else{$("#uniform-billing_country span").text("United States");$("#billingDetails input[name='billing_firstname']").val("");$("#billingDetails input[name='billing_lastname']").val("");$("#billingDetails input[name='billing_address_one']").val("");$("#billingDetails input[name='billing_address_two']").val("");$("#billingDetails input[name='billing_city']").val("");$("#billingDetails select[name='billing_state']").val("");$("#billingDetails input[name='billing_state_input']").val("");$("#billingDetails input[name='billing_zip']").val("");$("#billingDetails select[name='billing_country']").val("US");$("#billingDetails input[name='billing_phone']").val("");$("#billingDetails input[name='billing_state_input']").hide();$("#billingDetails select[name='billing_state']").show()}},changePaymentMode:function(){if($(this).val()==2){$("#payment-card-details select").attr("disabled","disabled");$("#payment-card-details input").attr("disabled","disabled");$("#payment-card-details").hide()}else{$("#payment-card-details select").attr("disabled",false);$("#payment-card-details input").attr("disabled",false);$("#payment-card-details").show()}},applyPromotion:function(){var params={discount_code:$('input[name="promotion_promo_code"]').val(),dbh_dollar:$('input[name="promotion_dbh_dollar"]').val()};Global.getJSONAction("ApplyDiscountAndDBHDollar",params,function(data){$("#promo_code_msg").html(data.response.promo_code_msg);$("#dbh_dollar_msg").html(data.response.dbh_dollar_msg);var country_code=$("#shippingDetails .shipping_country").val();var state_code=$("#shippingDetails .shipping_state").val();var params={shipping_country:country_code,shipping_state:state_code};Global.loadAction("#cart-sideview-container","CartSideview",params,function(data){$("#checkout-total-balance").text($("#side-view-cart-details .total span").text())})})}};